<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="questionlink">
<title>QuestionLink Tutorial • questionlink</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="QuestionLink Tutorial">
<meta property="og:description" content="questionlink">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">questionlink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_use_cases.html">Advanced Use Cases</a>
    <a class="dropdown-item" href="../articles/questionlink_tutorial.html">QuestionLink Tutorial</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MatRoth/questionlink/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="questionlink_tutorial_files/kePrint-0.0.1/kePrint.js"></script><link href="questionlink_tutorial_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>QuestionLink Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MatRoth/questionlink/blob/HEAD/vignettes/questionlink_tutorial.Rmd" class="external-link"><code>vignettes/questionlink_tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>questionlink_tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation-and-methodological-background">00 Motivation and methodological background<a class="anchor" aria-label="anchor" href="#motivation-and-methodological-background"></a>
</h2>
<p>The QuestionLink R-package aims to help researchers who want to
harmonize survey data on a concept that were gathered with different
questions. Specifically, the focus lies on (single) survey questions
used to capture a latent construct, such as attitudes, values,
interests, or subjective evaluations.</p>
<p>Consider two different questions on respondents’ subjective
evaluation of their general health:</p>
<blockquote>
<p><strong>European Social Survey (ESS)</strong></p>
<p>How is your health in general? Would you say it is…</p>
<p>Very good / Good / Fair / Bad / Very bad</p>
</blockquote>
<blockquote>
<p><strong>International Social Survey Programme (ISSP)</strong></p>
<p>In general, would you say your health is…</p>
<p>Excellent / Very good / Good / Fair / Poor</p>
</blockquote>
<p>How would you compare (or even combine) responses to these two
questions?</p>
<p>Such problems are the purview of ex-post harmonization, a
methodological field that seeks to assess and improve the comparability
of data that have already been collected. Such harmonization can be
challenging, but increasing comparability and combining (survey) data
across different data sources opens up <a href="https://blog.gesis.org/the-sum-and-its-parts-the-benefits-of-combining-data-from-different-surveys/" class="external-link">many
new opportunities for research</a>. In what follows, we will give a
brief overview of the challenges this entails to motivate the
QuestionLink R package.</p>
<div class="section level3">
<h3 id="harmononizing-single-item-survey-questions-for-latent-constructs">Harmononizing (single-item) survey questions for latent
constructs<a class="anchor" aria-label="anchor" href="#harmononizing-single-item-survey-questions-for-latent-constructs"></a>
</h3>
<p>Harmonizing data measured with different questions across different
surveys is not easy. For example, before we can even think of combining
data across different questions, we need to ensure that <a href="https://blog.gesis.org/apples-and-oranges-how-to-find-out-if-two-questions-measure-the-same-concept/" class="external-link">different
questions actually measure the same concept</a>. However, even if they
do, we often need to align their measurement units. In other words,
before comparing or combining data across questions, we need to ensure
that their numerical response scores imply the same level of the
measured construct.</p>
<p>Consider again the example about general health. Now imagine a
respondent who chose the third response option (“good”) in the ISSP
question. What response would they have chosen in the ESS question? Also
the third response option? But that would be “fair” in the ESS. Or
perhaps they would have also chosen “good” in the ESS; thus choosing the
second instead of the third response option. In any case, we cannot be
certain. And as it turns out, the empirical reality is more complicated
than just matching the same response options via recoding. Instead, at
least for the ESS and ISSP waves in Germany, <a href="https://www.gesis.org/en/services/processing-and-analyzing-data/data-harmonization/question-link/general-health" class="external-link">QuestionLink
derived the following harmonization solution</a> from ISSP to ESS:</p>
<p><img src="figures/General_health_example.svg"></p>
<p>As it turns out, matching a “3” in the ISSP question with a “3” in
the ESS question would be inadequate. That seems plausible, since “good”
and “fair” are rather different response labels. But matching “good” and
“good” across ISSP and ESS also does not work perfectly. After all,
respondents take the whole response scale into account when answering a
question.</p>
<div class="section level4">
<h4 id="harmonizing-measurement-units">Harmonizing measurement units<a class="anchor" aria-label="anchor" href="#harmonizing-measurement-units"></a>
</h4>
<p>However, how did we derive these values and how are they justified?
To understand what is happening here, we have to take a step back and
look at the difference between (observed) response scores and (latent)
construct expressions.</p>
<p>If we have a single question measuring a latent construct (such as
general health), we have to keep in mind that the construct itself does
not have natural categories or levels. Instead, the latent construct in
respondents’ minds are amorphous ideas that can be best understood as a
continuous value. When respondents then answer a question about that
construct, they recall (or infer) their approximate position on that
latent, continuous dimension. However, they cannot express this position
directly in a survey. Instead, they have to choose a response option
they feel best represents that position. And those response options are
not continuous, they are discrete and (only) ordinal. In other words,
observed response scores are the product of respondents mapping a
continous latent construct value onto a discrete, ordinal response
scheme.</p>
<p>Visually, we might imagine our sample of respondents to have a
continuous distribution of “true” latent construct values. Depending on
their value, i.e., their position on the continuum, they choose a
response option. This implies that response options “cut” the
distribution of latent scores into ordinal response scores. (This
simplified view ignores random response error. For a more realistic
model, consider IRT models or differential item functioning methods in
general.)</p>
<p><img src="figures/measurement_units_continuous_to_ordinal.jpg"></p>
<p>In practice, social scientists often ignore this detail, because we
can often treat the ordinal observed response scores as pseudo-metric.
However, when we harmonize two different questions for the same
construct, the issue becomes pressing. That is because different
questions (different wording, different response scales etc.) project
latent scores differently onto observed scores. They “cut” the latent
continuum into ordinal scores with different thresholds; both thresholds
in different positions or even a different number of thresholds when the
number of response options differs. For a bit more on this issue, we
recommend reading this <a href="https://blog.gesis.org/ceci-nest-pas-une-pipe-disentangling-measurement-and-reality-in-ex-post-harmonization/" class="external-link">blog
post</a>.</p>
<p>How then can we bridge these differences between two (or more)
questions for the same construct? Commonly considered approaches are
linear stretching and z-standardization. Both are insufficient in most
cases, as you will discover yourself in the section on <a href="#sec-insufficient-alternatives">insufficient alternatives</a>.</p>
</div>
<div class="section level4">
<h4 id="observed-score-equating-in-a-random-groups-design-ose-rg">Observed score equating in a random groups design (OSE-RG)<a class="anchor" aria-label="anchor" href="#observed-score-equating-in-a-random-groups-design-ose-rg"></a>
</h4>
<p>Instead of these alternatives, QuestionLink applies a method called
<strong><em>observed score equating in a random groups
design</em></strong> <strong>(OSE-RG)</strong>. In this context, we can
only give you a basic intuition. If you are interested, we recommend
these two sources to delve deeper into equating.</p>
<p>Kolen and Brennan cover equating in-depth in their book:</p>
<blockquote>
<p>Kolen, M. J., &amp; Brennan, R. L. (2014). <em>Test Equating,
Scaling, and Linking</em> (3rd ed.). Springer. <a href="https://doi.org/10.1007/978-1-4939-0317-7" class="external-link uri">https://doi.org/10.1007/978-1-4939-0317-7</a></p>
</blockquote>
<p>However, equating was originally conceived to harmonize multi-item
scales. For applying equating algorithms to harmonize two single survey
questions, see:</p>
<blockquote>
<p>Singh, R. K. (2022). Harmonizing single-question instruments for
latent constructs with equating using political interest as an example.
<em>Survey Research Methods</em>, <em>16</em>(3), 353–369. <a href="https://doi.org/10.18148/srm/2022.v16i3.7916" class="external-link uri">https://doi.org/10.18148/srm/2022.v16i3.7916</a></p>
</blockquote>
<p>However, we can quickly get an intuition of how OSE-RG works. At its
core, OSE-RG tries to answer the question what a respondent with a
certain observed score in one question would answer, on average, in
another question on the same construct. As in our example above, what
would a respondent who chose a “3 - good” in the ISSP choose in the ESS
question on average? The result of OSE-RG then was: 2.29 on average.
This “on average” both acknowledges the role or random response error as
well as the fact that there is seldom an exact integer correspondence
between response options of two questions (e.g., 3 = 4).</p>
<p>This still leaves the question, how we can get these
<strong>equivalent values</strong>. A first idea might be to show
respondents both questions and then compare their responses. In such a
setup, we might then take respondents who choose a “1” on question A and
average the responses they gave on question B to get the equivalent
value. Then we repeat that process for scores 2, 3, and so on. This is,
in fact, a practiced equating approach for multi-item scales called
<strong>single-group design</strong>. However, for single questions in
survey research, the approach is often not feasible. First, the
procedure only works if respondents answeres to the questions are
independent. Yet with only two questions, respondents will probably
rememer their previous answer. This creates a bias that even a
randomized order cannot solve completely. Second, we almost never have
single-group data available in existing survey data sources and we might
not be able to afford collecting single-group data on all questions in
all combinations for our harmonization project.</p>
<p>So as the “RG” or OSE-RG already implies, we use another research
design in QuestionLink: The <strong>random groups</strong> design. This
approach is best understood when we imagine a split-half experiment,
where one random half of respondents sees one question and the other
half the other question. Now the important point is that due to the
randomness of group assignment, we expect no systematic differences
between the groups in terms of their actual construct values. In such an
experiment, both groups have the same latent distribution of the
relevant construct. They feel equally healthy on average, with the same
standard deviation and so on. However, the distribution of measured
values will be quite different, because each question maps this latent
distribution differently onto observed response scores.</p>
<p>Visually, we might imagine the situation like this:</p>
<p><img src="figures/08_population_link.jpg"></p>
<p>The continuous distributions in the middle are the “true” contruct
distributions in both random groups. They mirror each other, because
they are identical through the random groups design. However, we see
that the two questions (above and below) have different thresholds. They
map the latent scores differently onto observed response scores. This
means, for example, that a person with a specific general health (yellow
point), would choose different responses in the two questions.</p>
<p>The result on an aggregate level is that we get two different
observed response distributions (think: frequency tables) for the two
questions, even though they measure the same latent distribution.
Responses to both questions are, after all, randomly drawn from the same
population:</p>
<p><img src="figures/02_random_groups_design.jpg"></p>
<p>What OSE-RG now does is to simply transform scores of one question so
that its observed response distribution aligns with the shape of the
other question’s observed response distribution. That sounds very
abstract, but is actually really intuitive. Imagine we want to harmonize
two questions and we know that the underlying population (and thus the
latent distribution) are the same. How should the average responses to
the two questions be, after successful harmonization? Identical, of
course. After all, both random groups have the same true mean construct
score (e.g., the same mean general health). Similarly, we would expect
the same standard deviation, the same skewness, and the same
kurtosis.</p>
<p>If we feed data into an OSE-RG algorithm, we get, in essence, a
recording table with which we can harmonize one question to the format
of the other. If we apply it, we get just what we want: The same
response distribution shape in the random groups setting, regardless of
the question. There are different algorithms to achieve that. The
simplest is linear equating, which assumes normally distributed
responses and only harmonizes the mean and standard deviation. However,
since response distributions are often skewed, we instead use
equipercentile equating, which is more flexible and also harmonizes
differences in skewness and kurtosis. You can learn more about these
algorithms in two blog posts on <a href="https://blog.gesis.org/the-new-normal-linear-equating-of-different-instruments/" class="external-link">linear
equating</a> and <a href="https://blog.gesis.org/cats-are-liquids-equipercentile-equating-of-different-instruments/" class="external-link">equipercentile
equating</a>.</p>
<p>However, in a nutshell, equipercentile equating looks at the
cumulative relative frequencies of both questions in the random groups
data (i.e., 10% chose response 1, 25% chose response 2 or less, 37%
chose response 3 or less and so on). The algorithm then transforms all
responses of one question (B) into their percentiles. And then those
percentiles are transformed back into (continuous approximations) of
responses in the other question (A).</p>
<p><img src="figures/05_equipercentile_equating.jpg"></p>
<p>The result after harmonization then looks like this:</p>
<p><img src="figures/05_result.jpg"></p>
<p>The result of this recoding of responses to B is that the
distribution shape (e.g., mean and standard deviation) now align between
A and B. Now it is important no note that this does not only harmonize
the current random groups data. Instead, once such a recoding table has
been derived from the random groups data, we can use it to harmonize the
two questions in many other data sets as well. The only assumption that
we need is that the two questions work the same in those other samples
as well (see the section on <a href="https://matroth.github.io/questionlink/articles/advanced_use_cases#population-invariance">Population
invariance</a>).</p>
</div>
<div class="section level4">
<h4 id="finding-random-groups-data">Finding random groups data<a class="anchor" aria-label="anchor" href="#finding-random-groups-data"></a>
</h4>
<p>The only remaining issue is that we usually cannot perform
methodological split-half experiments for all the many questions we
might want to harmonize for a project. However, when we harmonize data
from survey programs we might find that we already have random groups
data, at least for some of the questions for a construct that we want to
harmonize. Specifically, we are looking for instances were two questions
were used in random samples of the same population at the same time.</p>
<p>For example, imagine two survey programs which randomly sample the
adult German population along overlapping time series. Then we could
take samples of both surveys (with their respective questions for our
construct) from the same year and use that for our equating.</p>
<p><img src="figures/survey_program_links.jpg"></p>
<p>This approach has the advantage that we can reuse existing data. Data
that we most likely have researched and prepared for the harmonization
project anyway. However, finding such links can be daunting if done
manually. Consider the <a href="https://www.gesis.org/en/services/processing-and-analyzing-data/data-harmonization/question-link/general-life-satisfaction" class="external-link">QuestionLink
example for general life satisfaction</a> across several national and
international survey programs with random samples of the adult German
population:</p>
<p><img src="figures/csm_General_Life_Satisfaction_overview_81dd82e781.png"></p>
<p>The figure shows us all the different questions for general life
satisfaction (in black to the right of the plot). Then in color, each
row is one survey program that used the respective question. And then
each dot represents a wave where that question was used in that survey
program in a specific year. On the one hand, the figure makes us
optimistic, that finding opportunities for equating across survey
programs is quite realistic, at least for more common constructs.</p>
<p>On the other hand, we still face some obstacles. First, there are
some questions that we cannot harmonize directly, because they do not
share a year in which they were used. Consider, for example, the
questions “EVS 10pt” and “GPANEL 5pt”. Second, we would also like to use
all possible opportunities for equating (i.e., connection) instead of
just using one possible connection. This is because equating, like all
empirical methods, comes with random error (for example due to the
randomness of the sampling process). Combining several equatings makes
them more robust.</p>
<p>Fortunately, the QuestionLink R-Package helps solves all these issues
automatically. To understand how that works, we need to consider the
three types of connections that provide opportunities for equating. And
we need to understand how to aggregate the results of different
connections.</p>
</div>
<div class="section level4">
<h4 id="types-of-connections">Types of connections<a class="anchor" aria-label="anchor" href="#types-of-connections"></a>
</h4>
<p>QuestionLink finds three types of connections: Direct, time-relaxed,
and relay connections. The first type, <strong>direct
connections</strong>, is the case we have already discussed: Using data
where two questions were used in (random samples of) the same
populations in the same year:</p>
<p><img src="figures/links_direct.jpg"></p>
<p>However, sometimes we can only find instances where two questions
were used in almost the same year, but not a direct connection. We call
that <strong>time-relaxed connections</strong>, because to use them we
need to relax the constraints we put on time overlap. The QuestionLink
R-package allows you to choose just how much difference in years you
want to allow. Often, one year can be enough. For example, when one
survey covers even years and the other survey covers odd years.
Time-relaxation is, of course, easier to justify with constructs that
are relatively stable over time than with those that fluctuate year by
year. However, please consider that QuestionLink uses all possible
connections at one. This often means we have counterbalancing
time-relaxed connections (i.e., harmonizing one year earlier and then
harmonizing one year later):</p>
<p><img src="figures/links_time_relaxation.jpg"></p>
<p>The final and most powerful tool are <strong>relay
connections</strong>. They become possible, because equating can be
chained. Imagine a situation with three questions, A, B, and C. We
happen to have random groups data for A-C and for B-C. However, our goal
is to harmonize A to C. Fortunately, we can achieve this easily by
equating A to C, and then equating the values of A in the format of C to
B. In other words, we harmonize A to B via the relay C. The only
downside to such relay connections is, that they incur random errors
twice during equating. However, we can usually find many of such relay
connections and by aggregating them we can mitigate this issue.</p>
<p><img src="figures/links_relay.jpg"></p>
<p>With these three types of connections, our chances to be able to
harmonize the questions for a construct we are interested in have risen
dramatically. At the same time, if we find and apply all these
connections we are left with many equating solutions (~ recoding tables)
for each question pair (and in both directions; e.g., A-&gt;B &amp;
B-&gt;A). And most likely, these solutions will fluctuate due to random
sampling errors. What QuestionLink now does is to aggregate all
harmonization solutions (one for each connection between two questions
in one direction) into a single, robust harmonization solution.</p>
<p>After finding all possible connections and performing equatings for
each connection, QuestionLink then <strong>summarizes all possible
solutions</strong> for a question pair (in one direction) into a single
recoding table. This is done be calculating the median equivalent value
for each score of the question we want to harmonize. The result is that
random errors are mitigated to a large extent. This might seem abstract,
but we demonstrate this in the article of advanced use cases in the
section <a href="https://matroth.github.io/questionlink/articles/advanced_use_cases#retrieving-recoding-tables">retrieving
recoding tables</a>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="setting-up-a-simulated-population">01 Setting up a simulated population<a class="anchor" aria-label="anchor" href="#setting-up-a-simulated-population"></a>
</h2>
<p>Our goal in this section and the next is to simulate survey responses
on different measurement instruments that measure the same construct. To
do so, we fist simulate the underlying “true” development of that
construct in our simulated population over time. Usually, we think of
true construct scores as continuous, one-dimensional values. There are
no natural steps or categories in constructs such as political interest,
life satisfaction, or intelligence. Instead we imagine them to be
seamless, gradual values along a dimension.</p>
<p>Our setup here is to create a data frame which will contain 2000
simulated construct values per year for every year from 1980 to
2020.</p>
<p>The code works as follows step-by-step:</p>
<ol style="list-style-type: decimal">
<li>We create the data frame (or tibble in the tidyverse) and populate
it with a year variable with values from 1980 to 2020. For now, the data
frame has 40 rows (one for each year).</li>
<li>We add a variable <code>target_construct_mean</code> which
represents the idealized trend over time that we want our simulated
construct to follow. The formula does nothing else than create a mean
value from <code>-0.5</code> to <code>0.5</code>. Over the forty years,
the mean will gradually (and linearly) increase.</li>
<li>Now we simulate for each year a sample of 2000 true scores. This
simulation assumes a normal distribution of true scores around our
target mean (<code>target_construct_mean</code>) for each year with a
standard distribution of 1. We “nest” a vector containing all 2000
scores in each cell in the variable <code>simulated_true_score</code>.
Currently, the data frame still only has 40 rows, but in each cell in
the last variable we have crammed 2000 values.</li>
<li>In the last step, we use <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> to arrive at a tidier
data frame. What unnest does is to unfold the score vectors in
<code>simulated_true_score</code> so that each row only contains one
value. In other words, we now unfold our data frame of 40 rows (each row
a year) into a data frame of 40 * 2000 = 80000 rows (each row a true
construct value).</li>
</ol>
<p>With the <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n()</a></code> function, we look at 10 randomly
selected rows from the 80000 rows of the simulated data frame. We see
that each row has a specific <code>year</code>, a target construct mean
<code>target_construct_mean</code> and a specific simulated value
<code>simulated_true_score</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'kableExtra'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     group_rows</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: viridisLite</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Installing questionlink with devtools</span></span>
<span><span class="co">#devtools::install_github("https://github.com/MatRoth/questionlink")</span></span>
<span><span class="co">## Installing questionlink with pak</span></span>
<span><span class="co">##install.packages("pak")</span></span>
<span><span class="co">#pak::pak("https://github.com/MatRoth/questionlink")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matroth.github.io/questionlink/">questionlink</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Helpers</span></span>
<span></span>
<span><span class="va">format_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>      full_width <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_sample_n</span> <span class="op">=</span> <span class="fl">2000</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span>,</span>
<span>  <span class="co"># construct linearly increases over time</span></span>
<span>  target_construct_mean <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span>, </span>
<span>  simulated_true_score <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">target_construct_mean</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">survey_sample_n</span>, <span class="va">.x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">simulated_true_score</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
target_construct_mean
</th>
<th style="text-align:right;">
simulated_true_score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
0.425
</td>
<td style="text-align:right;">
0.1022611
</td>
</tr>
<tr>
<td style="text-align:right;">
1981
</td>
<td style="text-align:right;">
-0.475
</td>
<td style="text-align:right;">
-2.0466704
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
0.275
</td>
<td style="text-align:right;">
0.0525974
</td>
</tr>
<tr>
<td style="text-align:right;">
1988
</td>
<td style="text-align:right;">
-0.300
</td>
<td style="text-align:right;">
-1.2951355
</td>
</tr>
<tr>
<td style="text-align:right;">
1987
</td>
<td style="text-align:right;">
-0.325
</td>
<td style="text-align:right;">
0.8903254
</td>
</tr>
<tr>
<td style="text-align:right;">
1986
</td>
<td style="text-align:right;">
-0.350
</td>
<td style="text-align:right;">
-1.8605866
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
0.200
</td>
<td style="text-align:right;">
1.8000765
</td>
</tr>
<tr>
<td style="text-align:right;">
1987
</td>
<td style="text-align:right;">
-0.325
</td>
<td style="text-align:right;">
-0.6609906
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
0.500
</td>
<td style="text-align:right;">
0.7836931
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
0.150
</td>
<td style="text-align:right;">
-0.9258391
</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="simulated-change-over-time">Simulated change over time<a class="anchor" aria-label="anchor" href="#simulated-change-over-time"></a>
</h4>
<p>Now we can plot these mean of these continuous construct scores over
time. We see that the “true” average construct score for our simulated
population slowly shifts by one standard deviation over the course of 40
years. In substantive terms, imagine the average of an opinion slowly,
and steadily increasing, year after year.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">simulated_true_score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                     minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="normally-distributed-simulated-scores-per-year">Normally distributed simulated scores per year<a class="anchor" aria-label="anchor" href="#normally-distributed-simulated-scores-per-year"></a>
</h4>
<p>However, the mean values for each year hide that we actually have a
(normal) distribution of construct scores for each year. In other words,
there is a spread of lower, medium, and higher construct scores in each
year. Below, we see these simulated “true” construct score distributions
for different years. For better visibility, only full decades are shown.
Observe how the distribution slowly wanders to the right, as the average
value increases over time.</p>
<p><em>(For those unfamiliar with these type of plots: This is a density
plot. It shows for construct values on the x-axis how frequent they are
in the data (or how probable each value is, actually). The y-axis values
do not have meaningful values. They are simply chosen by R so that the
area under the curve is one, so that the probability of the whole curve
is one, since it represents all values. As an intuition, think of
density plots as histograms for continuous data.)</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">#only select full decades</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">simulated_true_score</span>, color <span class="op">=</span> <span class="va">year</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">TRUE</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">+</span> <span class="co"># coloring</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="simulating-survey-responses">02 Simulating survey responses<a class="anchor" aria-label="anchor" href="#simulating-survey-responses"></a>
</h2>
<p>Now that we have simulated the continuous construct values, we need
to derive simulated response values. After all, survey respondents do
not give decimal values as their answer. Instead, they choose one of
several discrete, ordinal response options, such as “somewhat
agree”.</p>
<p>To simulate this, we will transform the continuous, simulated scores
into discrete, integer response scores. This is done by “cutting” the
continuous scores into discrete responses at certain thresholds, using
our <code>cut_responses()</code> helper function. (Please note that this
is an very simplistic view on actual response processes, but it serves
our needs here just fine.)</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># helper function that allows us to cut continuous values into ordinal chunks</span></span>
<span><span class="va">cut_responses</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">breaks</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ord_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">breaks</span>, <span class="cn">Inf</span><span class="op">)</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ord_vec</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For example: Calculating simulated responses for the year 2000. Below
we see the density plot for the continuous construct values we have
simulated for the population in the year 2000. The vertical lines over
the density plot represent the thresholds with which we will cut this
continuous construct into ordinal responses. Values up to the first
(leftmost) threshold will become the response score “1”, then between
the first and second threshold, a response score of “2” and so on.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutting_example</span> <span class="op">&lt;-</span> <span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    example_response <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span></span>
<span>      <span class="va">simulated_true_score</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">cutting_example</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">simulated_true_score</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Below we see the resulting simulated response distribution. The
barchart shows the relative frequency of the five possible response
options.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutting_example</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">example_response</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`relative frequency (%)` <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">example_response</span>, <span class="va">`relative frequency (%)`</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Example for a simulated response distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="section level4">
<h4 id="defining-four-question-versions">Defining four question versions<a class="anchor" aria-label="anchor" href="#defining-four-question-versions"></a>
</h4>
<p>Now we apply this process to simulate different questions. That means
questions which all capture the same concept, but with different
question wording, or different response scales. Such differences mean
that the same continuous true score distribution is cut into different
observed response distributions, because <a href="https://blog.gesis.org/not-by-any-stretch-of-the-imagination-a-cautionary-tale-about-linear-stretching/" class="external-link">the
thresholds differ</a>.</p>
<p>Specifically, we will simulate four different questions (A, B, C, and
D), which all capture our simulated construct. Questions A, B, and C are
all 5-point response scales. Questions B and C are based on the
thresholds of question A, but they are additively shifted (different
mean response) and multiplicatively stretched (different standard
deviation). Question D, meanwhile, is a 10-point instrument, to
demonstrate that QuestionLink can handle different numbers of response
options with ease.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response_thresholds_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">response_thresholds_B</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">response_thresholds_A</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span><span class="va">response_thresholds_C</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">response_thresholds_A</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.7</span></span>
<span><span class="va">response_thresholds_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    question_A <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_A</span><span class="op">)</span>,</span>
<span>    question_B <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_B</span><span class="op">)</span>,</span>
<span>    question_C <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_C</span><span class="op">)</span>,</span>
<span>    question_D <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_D</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
target_construct_mean
</th>
<th style="text-align:right;">
simulated_true_score
</th>
<th style="text-align:right;">
question_A
</th>
<th style="text-align:right;">
question_B
</th>
<th style="text-align:right;">
question_C
</th>
<th style="text-align:right;">
question_D
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-1.2861679
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-1.0353028
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-0.9451508
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-2.5047100
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-0.7500849
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
-0.5
</td>
<td style="text-align:right;">
-0.5626277
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="preparing-long-format-for-questionlink">Preparing long format for QuestionLink<a class="anchor" aria-label="anchor" href="#preparing-long-format-for-questionlink"></a>
</h4>
<p>Currently, the four questions are represented in a wide format data
frame. This means we have four variables, one for each question. This
also means we have four responses in every row. However, QuestionLink
expects data in long-format. That means each row in the dataframe
represents a single <code>response</code>. Each response has an
associated <code>year</code> (in which the response was collected) and a
<code>question</code> (which represents the different measurement
instruments). Transforming data from wide to long format is easily done
with <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">tidyr::pivot_longer()</a></code>. Below you see the first six
rows in the new, long format data frame:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span>   <span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"question"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"question"</span><span class="op">)</span>, values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"discard"</span>, <span class="st">"question"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">discard</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
question
</th>
<th style="text-align:right;">
response
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<div class="section level5">
<h5 id="overview-of-response-distributions">Overview of response distributions<a class="anchor" aria-label="anchor" href="#overview-of-response-distributions"></a>
</h5>
<p>Here we see the simulated response distributions across all four
question variants and across the years. Note that the plot only shows
the full decades 1980, 1990, 2000, 2010, and 2020.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span>, <span class="va">response</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>,</span>
<span>    relative_frequency <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="co"># Calculates relative response frequencies</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">response</span>, <span class="va">relative_frequency</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free_x"</span></span>
<span>  <span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="creating-artificial-gaps-in-the-timeseries">Creating artificial “gaps” in the timeseries<a class="anchor" aria-label="anchor" href="#creating-artificial-gaps-in-the-timeseries"></a>
</h4>
<p>One of the main advantages of QuestionLink is that it helps find
opportunities for harmonization across many different question variants,
surveys and their respective waves. To showcase this, we create gaps in
the time-series of our simulated question variants. This is a plausible
situation, when different survey programs begin or end their time series
at different intervals.</p>
<p>First, the current simulated data without gaps in the
time-series:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_all_years_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span></span>
<span></span>
<span><span class="va">plot_question_years</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">combined_df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">year_min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">combined_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>  <span class="va">year_max</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">combined_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>  <span class="va">years_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">year_min</span><span class="op">:</span><span class="va">year_max</span><span class="op">)</span></span>
<span>  <span class="va">major_breaks_vec</span> <span class="op">=</span> <span class="va">years_vec</span><span class="op">[</span><span class="va">years_vec</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">combined_df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>question <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">major_breaks_vec</span>,</span>
<span>                       minor_breaks <span class="op">=</span> <span class="va">years_vec</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu">plot_question_years</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="section level5">
<h5 id="showcasing-the-time-relaxation-feature">Showcasing the time-relaxation feature<a class="anchor" aria-label="anchor" href="#showcasing-the-time-relaxation-feature"></a>
</h5>
<p>The logic of OSE-RG, the method behind QuestionLink, dictates that we
have to match data from different instruments gathered from the same
“population”. Here that would ideally mean data randomly sampled from
the population (e.g., adult Germans) in the same year. However,
sometimes surveys collect data in alternating years and the direct years
cannot be easily matched. If a construct does not change dramatically
from year to year, we can “relax” this constraint; for example to allow
adjacent years. (For more information on time-relaxed connections, see
the section on <a href="#types-of-connections">types of
connections</a>.)</p>
<p>For this reason, we make it so that questions are only asked every
two years. In even years for A, B and C, but in odd years for D!</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"D"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">plot_question_years</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="showcasing-the-relay-link-feature">Showcasing the relay link feature<a class="anchor" aria-label="anchor" href="#showcasing-the-relay-link-feature"></a>
</h5>
<p>QuestionLink can also bridge larger gaps in joint time series, where
two questions do not overlap in time at all. This becomes possible with
relay links, where QuestionLink harmonizes one question to another relay
question and then that onwards to the actual target question. In our
example data, we will create a gap so that instruments A and B do no
longer overlap. However, A and B both overlap with questions C and D.
Hence we can form the relay links A -&gt; C -&gt; B and A -&gt; D -&gt;
B. (For more information on relay connections, see the section on <a href="#types-of-connections">types of connections</a>.)</p>
<p>Thus we arrive at our final simulated survey wave structure. (For
simplicity’s sake, we assume that each question is used by one of four
different surveys sampling the same population, but with different waves
schedules.)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Defining gaps in time series by defining the "possible years" for each question</span></span>
<span></span>
<span><span class="va">possible_years_lists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span>,</span>
<span>  D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span><span class="op">:</span><span class="fl">2005</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valid_year <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_lgl</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">possible_years_lists</span><span class="op">[[</span><span class="va">.y</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">valid_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valid_year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">plot_question_years</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="does-questionlink-work">03 Does QuestionLink work?<a class="anchor" aria-label="anchor" href="#does-questionlink-work"></a>
</h2>
<p>After putting in all this work to simulate different survey responses
for the same construct, we want to harmonize them again. To show how
easy this is with QuestionLink, let us harmonize our four simulated
questions in one pass. Later, we will discuss each step and the
respective options one by one. For now, note how we can complete the
entire harmonization process in one pipe with four lines of code. As an
example, we harmonize towards the format of question “A”.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonized_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span>, time_relaxation <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="../reference/ql_transform.html">ql_transform</a></span><span class="op">(</span>target <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="results-of-questionlink">Results of QuestionLink<a class="anchor" aria-label="anchor" href="#results-of-questionlink"></a>
</h3>
<p>Did it work? Let us find out by plotting the mean scores across the
time-series: Once unharmonized and once harmonized with
QuestionLink.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unharmonized_mean_plot</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"unharmonized"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">harmonized_mean_plot</span> <span class="op">&lt;-</span> <span class="va">harmonized_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">median_equivalent</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"QuestionLink harmonized"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combining both plots with patchwork::</span></span>
<span><span class="va">unharmonized_mean_plot</span> <span class="op">+</span> <span class="va">harmonized_mean_plot</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>QuestionLink has harmonized both the differences in the mean and the
differences in standard deviation. Hence, intercept and slope of our
four time-series now align. Subtantively speaking, this means that in
each year we can safely compare the average score across the four
instruments. It also means that QuestionLink has harmonized the growth
rate over time (i.e., the slope), by harmonizing the standard deviation
of all four questions. Below, we veryify this by looking at the standard
deviation directly:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unharmonized_sd_plot</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `standard deviation` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">`standard deviation`</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"unharmonized"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">harmonized_sd_plot</span> <span class="op">&lt;-</span> <span class="va">harmonized_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `standard deviation` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">median_equivalent</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">`standard deviation`</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"QuestionLink harmonized"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unharmonized_sd_plot</span> <span class="op">+</span> <span class="va">harmonized_sd_plot</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="sec-insufficient-alternatives">Insufficient alternatives<a class="anchor" aria-label="anchor" href="#sec-insufficient-alternatives"></a>
</h3>
<p>While QuestionLink worked well, you might ask yourself if all this
effort was worth it. To address these concerns, let us look at commonly
considered alternatives.</p>
<div class="section level4">
<h4 id="z-standardization">Z-standardization<a class="anchor" aria-label="anchor" href="#z-standardization"></a>
</h4>
<p>First, let us look at z-standardization. The approach centers and
scales variables so that their mean equals zero (<span class="math inline">\(\bar{x}=0\)</span>) and their standard deviation
equals one (<span class="math inline">\(S=1\)</span>). The resulting
scores are called <span class="math inline">\(z\)</span>-scores.</p>
<p>The formula is quite simple:</p>
<p><span class="math display">\[
z=\frac{x-\bar{x}}{S}
\]</span></p>
<p>We center by subtracting the arithmetic mean of the scores from each
score and the we scale by dividing by the standard deviation.</p>
<p>One complexity with z-standardization is that we can standardize the
same data-set in different ways. As an example, we now z-standardize our
simulated data-set in four ways:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Overall:</strong> Here we standardize all responses across
all four questions and all forty years in one go. This means we scale
with the mean and sd of the entire vector of response scores regardless
of question or year.</li>
<li>
<strong>By question:</strong> However, because we want to harmonize
the differences between the four questions, we might instead
z-standardize each question separately. This means scaling responses to
each question by the mean and sd of each question separately.</li>
<li>
<strong>By year:</strong> Another common idea is to z-standardize
year by year, regardless of the question. This means scaling responses
by the mean and sd of all questions year by year.</li>
<li>
<strong>By year and question combined:</strong> Lastly, we might
think that harmonization requires z-standardization over questions and
years at the same time. This means scaling responses by the mean and sd
of each question in each year separately.</li>
</ol>
<div class="callout-note">
<p>Note how in the code below, these distinctions are realized with the
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code> function. That function modifies the
following mutate statement so that the <code><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale()</a></code> function
standardizes by the correct mean and sd.</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z_example_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response_z_overall <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response_z_by_question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response_z_by_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response_z_by_year_question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z_overall_plot</span> <span class="op">&lt;-</span> <span class="va">z_example_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response_z_overall</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#scale_y_continuous(limits = c(1,10), breaks = c(1:10), minor_breaks = NULL)+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,<span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"overall"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">z_by_question_plot</span> <span class="op">&lt;-</span> <span class="va">z_example_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response_z_by_question</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#scale_y_continuous(limits = c(1,10), breaks = c(1:10), minor_breaks = NULL)+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"by question"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">z_by_year_plot</span> <span class="op">&lt;-</span> <span class="va">z_example_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response_z_by_year</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#scale_y_continuous(limits = c(1,10), breaks = c(1:10), minor_breaks = NULL)+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"by year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">z_by_year_question_plot</span> <span class="op">&lt;-</span> <span class="va">z_example_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response_z_by_year_question</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co">#scale_y_continuous(limits = c(1,10), breaks = c(1:10), minor_breaks = NULL)+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"by year and question"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combining both plots with patchwork::</span></span>
<span><span class="va">z_overall_plot</span> <span class="op">+</span> <span class="va">z_by_question_plot</span> <span class="op">+</span> <span class="va">z_by_year_plot</span> <span class="op">+</span> <span class="va">z_by_year_question_plot</span> <span class="op">+</span>   <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>All four z-standardization solutions do not look as we might have
hoped. Let us look at each version in turn to discuss what went
wrong.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Overall:</strong> If we apply z-standardization to all
scores across questions and years, then nothing changes substantially.
Only the units are now z-scores, but all question differences persist
exactly as before.</li>
<li>
<strong>By question:</strong> If we z-standardize each question, we
get these parallel lines. Each question timeseries is no centered at
zero in the middle. Each has the same growth over time. This obviously
does no longer represent the true construct, which grows linearly from
1980 to 2020.</li>
<li>
<strong>By year:</strong> Scaling by year leads to totally chaotic
results. This is because in each year we scale by a mix of the mean and
standard deviation of each question.</li>
<li>
<strong>By year and question combined:</strong> Lastly, scaling by
both year and question results in somewhat harmonized data, but
unfortunately all time-series information has been lost. Instead of the
steady growth of the true construct, we now see no change over time at
all.</li>
</ol>
</div>
<div class="section level4">
<h4 id="linear-stretching">Linear Stretching<a class="anchor" aria-label="anchor" href="#linear-stretching"></a>
</h4>
<p>A second frequently considered alternative is linear stretching. This
method sets the minimum and maximum responses of two questions with a
different number of scale points as equal. The process is best
understood by examining the following function. Here we supply scores of
a source question <code>x</code> that we want to harmonize. We also
supply the maximum and minimum score of that source question
<code>x</code> (<code>max_source</code> and <code>min_source</code>) as
well as the maximum and minimum score of a target question
(<code>max_target</code> and <code>min_target</code>). The function the
linearly “stretches” responses of x towards the different scale point
format of the target question.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_stretching</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, </span>
<span>                              <span class="va">max_source</span>, </span>
<span>                              <span class="va">max_target</span>, </span>
<span>                              <span class="va">min_source</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                              <span class="va">min_target</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="va">min_source</span> <span class="co">#shift so that lowest score becomes 0</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="va">max_source</span> <span class="op">-</span> <span class="va">min_source</span><span class="op">)</span> <span class="co"># scale to range from 0 to 1</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="op">(</span><span class="va">max_target</span> <span class="op">-</span> <span class="va">min_target</span><span class="op">)</span> <span class="co"># scale to range from 0 to target highest minus target lowest</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">min_target</span> <span class="co"># shift so that lowest becomes target lowest</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Here an example, where we stretch a 5-point response scale
<code>x</code> towards a 7-point response scale format
<code>y</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>  x_stretched <span class="op">=</span> <span class="fu">linear_stretching</span><span class="op">(</span><span class="va">x</span>, </span>
<span>                                  max_source <span class="op">=</span> <span class="fl">5</span>, <span class="co"># original 5-point scale</span></span>
<span>                                  max_target <span class="op">=</span> <span class="fl">7</span>, <span class="co"># 7-point target</span></span>
<span>                                  min_source <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  min_target <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, values_to <span class="op">=</span> <span class="st">"scores"</span>, names_to <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">scores</span>, <span class="va">variable</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">scores</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Other variants of linear stretching are <strong>POMP</strong>
(percentage of maximum possible) or <strong>scaling to a range from 0 to
1</strong>. Both are simply variants of linear stretching.</p>
<p>Pomp would transform <code>x</code> with the scores 1, 2, 3, 4, and 5
to these values:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">linear_stretching</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                  max_source <span class="op">=</span> <span class="fl">5</span>, <span class="co"># original 5-point scale</span></span>
<span>                  max_target <span class="op">=</span> <span class="fl">100</span>, <span class="co"># 7-point target</span></span>
<span>                  min_source <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  min_target <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0; 25; 50; 75; 100"</span></span></code></pre>
<p>And scaling to a range from 0 to 1 would transform <code>x</code>
with the scores 1, 2, 3, 4, and 5 to these values:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">linear_stretching</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                  max_source <span class="op">=</span> <span class="fl">5</span>, <span class="co"># original 5-point scale</span></span>
<span>                  max_target <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 7-point target</span></span>
<span>                  min_source <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                  min_target <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"; "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0; 0.25; 0.5; 0.75; 1"</span></span></code></pre>
<div class="section level5">
<h5 id="applying-linear-stretching">Applying linear stretching<a class="anchor" aria-label="anchor" href="#applying-linear-stretching"></a>
</h5>
<p>Does this approach work? Let us find out by stretching all responses
towards the format of question A.</p>
<p>If you will recall, these were the minimum and maximum response
scores for each question:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>min_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>,</span>
<span>            max_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">##   question min_score max_score</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> A                1         5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> B                1         5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> C                1         5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> D                1        10</span></span></code></pre>
<p>In other words, we already see that only scores of “D” will be
transformed at all.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stretched_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    stretched_response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"D"</span>,</span>
<span>                                <span class="fu">linear_stretching</span><span class="op">(</span><span class="va">response</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                                <span class="va">response</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Let us look at the result visually:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unharmonized_plot</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">response</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"unharmonized"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">stretched_plot</span> <span class="op">&lt;-</span> <span class="va">stretched_df</span> <span class="op">|&gt;</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">stretched_response</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>   </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"linear stretch"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Combining both plots with patchwork:: </span></span>
<span></span>
<span><span class="va">unharmonized_plot</span> <span class="op">+</span> <span class="va">stretched_plot</span> </span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>Linear stretching did not harmonize responses in any meaningful way.
The goal was the format of question “A”, but all other questions deviate
from that. Questions “B” and “C” even remain unchanged, because they
were also 5-point scales. Question “D” was transformed, but not as
intended.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="questionlink-step-by-step">04 QuestionLink step by step<a class="anchor" aria-label="anchor" href="#questionlink-step-by-step"></a>
</h2>
<p>After seeing the usefulness of QuestionLink We hope that you are
motivated to delve a bit deeper into how to use it.</p>
<p>In our earlier example, we chained all QuestionLink functions
together in a single <code>|&gt;</code> pipe. Now, however, we look at
the functions step by step. We also look at two helper functions, that
will allow us to diagnose our data set and to plot equating
opportunities.</p>
<div class="section level3">
<h3 id="wrangling-our-combined-dataset">Wrangling our combined dataset<a class="anchor" aria-label="anchor" href="#wrangling-our-combined-dataset"></a>
</h3>
<p>Before we can start out, we need to wrangle our combined data into
the correct form.</p>
<p>This means:</p>
<p><span class="math inline">\(1\)</span> Bringing data into the
so-called long format, where each row in the data frame is one
response.</p>
<p><span class="math inline">\(2\)</span> Naming the columns along the
convention that QuestionLink expects (mandatory: <code>year</code>,
<code>question</code>, &amp; <code>response</code>; optional:
<code>weight</code> &amp; <code>population</code>)</p>
<p><span class="math inline">\(3\)</span> Inverting response scores of
inverted or reversed items (see section “inverted items”).</p>
<p><span class="math inline">\(4\)</span> Removing cases with missing
values (see section “missing values”).</p>
<div class="section level4">
<h4 id="long-format-data">Long format data<a class="anchor" aria-label="anchor" href="#long-format-data"></a>
</h4>
<p>For QuestionLink, we decided on a format that most social scientists
are well acquainted with: a data set in <strong>long format</strong>.
For an in depth explanation of how to shape data into long format, see
here: <a href="https://r4ds.hadley.nz/data-tidy#sec-pivoting" class="external-link">R for Data
Science (Wickham et al., 2023)</a></p>
<p>The most common case are data that are spread across waves. Consider
this toy example for data in <strong>wide format</strong>. Here,
<em>each row is one respondent</em> with answers across three survey
waves. However, for many analyses such as multilevel-models (and for
QuestionLink), we need to bring the data into long format where <em>each
row is one observation</em>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wide_format_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  respondent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  year_2000 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span>,</span>
<span>  year_2002 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span>,</span>
<span>  year_2004 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wide_format_example</span> <span class="op">|&gt;</span> <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
respondent
</th>
<th style="text-align:right;">
year_2000
</th>
<th style="text-align:right;">
year_2002
</th>
<th style="text-align:right;">
year_2004
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>In R (when using <code>dplyr</code> from the <code>tidyverse</code>),
we can easily lengthen that data with <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer()</a></code>. Here
we see the first six rows of the new data frame in long format. There
are now three rows per respondent because we have one row per
observation (i.e., one row per wave).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wide_format_example</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"year_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"wave"</span>, values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
respondent
</th>
<th style="text-align:left;">
wave
</th>
<th style="text-align:right;">
score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year_2000
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year_2002
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
year_2004
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
year_2000
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
year_2002
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
year_2004
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>In <strong>QuestionLink</strong> we need just such a long format
structure, but with some additional information. Most importantly, for
every observation (i.e., response) we need a variable that tell us with
which question that response was collected. Conveniently, we already did
this step while simulating our example data.</p>
<p>If you consider the data frame we had prepared, you will find that it
is quite simple. Each row is a single response. The <strong>three
mandatory variables</strong> for QuestionLink are this the
<code>year</code> in which the response was collected, the
<code>question</code> that was used to collect the response, and the
<code>response</code> as a raw, harmonized score.</p>
<p>Additionally, QuestionLink accepts <strong>two optional
variables</strong>: <code>weight</code> and <code>population</code>. We
will learn more about them under “advanced use cases” later on. However,
in short: <code>weight</code> allows us to weight responses so that the
samples become more comparable across source surveys. An example might
be design weights, such as the common practice in several German survey
programs to over sample the new federal states of former East Germany.
Meanwhile, <code>population</code> allows us to add information from
which population a response was collected. QuestionLink then avoids
matching responses across populations, because this would break the
assumptions of observed score equating.</p>
<p>One last requirement for a harmonizable data frame is that it
contains <strong>no missing values</strong>. This is easily realized in
(tidyverse) R with <code>tidyr::drop_NA</code>. However, if there are
many missing values in some or all source surveys, we recommend that you
look at our in depth discussion of missing values later on.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
question
</th>
<th style="text-align:right;">
response
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="ql_prepare-finding-harmonization-connections">
<code>ql_prepare</code> Finding harmonization connections<a class="anchor" aria-label="anchor" href="#ql_prepare-finding-harmonization-connections"></a>
</h3>
<p>With a data frame in the correct format, we can begin harmonization
by calling the QuestionLink function <code>ql_prepare</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This function call results in a QuestionLink object that contains
information about all opportunities to harmonize the questions into each
other. However, at this step in the process the actual harmonization
calculations have not been performed.</p>
<p>The object mainly contains the possible connections and the whole
source data set!</p>
<p>We can extract the connections using the function <code><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr()</a></code>
:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
source_year
</th>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
source_population
</th>
<th style="text-align:right;">
target_year
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:left;">
target_population
</th>
<th style="text-align:left;">
connection_type
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:right;">
1982
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1982
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:right;">
1982
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1982
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:right;">
1984
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1984
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:right;">
1984
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1984
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
</tr>
</tbody>
</table>
<p>If you consider the first row, you see that we can harmonize “source”
question B in the year 1980 towards the “target” question C, because
both questions have data from that year.</p>
<p>A more convenient way to look at the connections QuestionLink has
found is to use its <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method:</p>
<hr>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary: QuestionLink Prepare</span> <span style="color: #00BBBB;">───────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## Current stage of the QuestionLink workflow: <span style="font-weight: bold;">ql_prepare ✔</span> -&gt; ql_harmonize -&gt;</span></span>
<span><span class="co">## ql_transform</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Number of unique question combinations: <span style="color: #0000BB;">4</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Number of found connections:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Direct connections: <span style="color: #0000BB;">28</span></span></span></code></pre>
<pre><code><span><span class="co">## • Time relaxation connections: <span style="color: #0000BB;">0</span></span></span></code></pre>
<pre><code><span><span class="co">## • Relay connections: <span style="color: #0000BB;">0</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Additional information:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • No population variable supplied. Data is interpreted as comming from one</span></span>
<span><span class="co">## population.</span></span></code></pre>
<pre><code><span><span class="co">## • No weight variable was supplied.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over question combinations:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Source question   Target question    Direct   Time relaxation   Relay</span></span>
<span><span class="co">## ----------------  ----------------  -------  ----------------  ------</span></span>
<span><span class="co">## A                 C                       8                 0       0</span></span>
<span><span class="co">## C                 A                       8                 0       0</span></span>
<span><span class="co">## B                 C                       6                 0       0</span></span>
<span><span class="co">## C                 B                       6                 0       0</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over response options found:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Question   Response options                User supplied </span></span>
<span><span class="co">## ---------  ------------------------------  --------------</span></span>
<span><span class="co">## A          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## B          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## C          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## D          1, 2, 3, 4, 5, 6, 7, 8, 9, 10   FALSE</span></span></code></pre>
<hr>
<p>We see several sections in the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<ol style="list-style-type: decimal">
<li>“Summary: QuestionLink Prepare” shows where in the QuestionLink
process we are. We also see the number of unique question combinations,
which will be explained soon.</li>
<li>“Number of found connections” show us that we found 34 “direct
connections”, meaning that two questions were used in exactly the same
year in the same population. For now, the other two connection types are
zero.</li>
<li>“Additional information” reminds us that we did not provide any of
the two optional variables <code>weight</code> or
<code>population</code>. For now, this is fine.</li>
<li>“Overview of question combinations” is the most interesting part of
the output. It shows which questions we can harmonize with each other.
It also details which connections we have to do so. Here we note that we
currently do not harmonize all questions with all other questions. We
will resolve this soon.</li>
<li>“Overview over response options found” shows which response values
each question has. This is a good moment to reflect if this is
consistent with what you expect. Here you might find negative values (if
missings were not adequately coded) or other issues that need to be
resolved first. However, for a more in depth check, try
<code>ql_check</code> , which we will discuss later.</li>
</ol>
<p>As we have seen under “Overview of question combinations”, we have
not yet fully harmonized all questions. Specifically, we cannot
harmonize from <code>source_question</code> “A” towards
<code>target_question</code> “B” and vice versa. We also cannot
harmonize from <code>source_question</code> “C” towards
<code>target_question</code> “D” and vice versa.</p>
<p>We can validate this by looking under the hood of the prepare object,
which contains all found connections. Here we find only “direct”
connections, because we have not allowed any of the more advanced
QuestionLink features yet. Direct connections are instances where two
questions are asked in the same year.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">source_question</span>,<span class="va">target_question</span>,<span class="va">connection_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">connection_type</span>,</span>
<span>                       values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
direct
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>Our current problem is apparently that there are no direct
connections between some of the questions. This becomes apparent if we
again consider the years in which each question was used:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">plot_question_years</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>We cannot harmonize directly between “A” and “B”, because there is a
long gap between their two time-series (from 1991 to 1999). We also
cannot directly harmonize between “C” and “D” because waves asking
question “C” occurred in even years and questions asking “D” occurred in
odd years.</p>
<p>Fortunately, QuestionLink can often compensate for both such issues.
We just have to give it permission to do so.</p>
<div class="section level4">
<h4 id="bridging-different-survey-rhythms-with-time_relaxation">Bridging different survey rhythms with
<code>time_relaxation</code><a class="anchor" aria-label="anchor" href="#bridging-different-survey-rhythms-with-time_relaxation"></a>
</h4>
<p>It is not uncommon that surveys have a slightly different wave rhythm
from each other. In our example, questions “C” and “D” share a long time
series, but are slightly out of sync due to even and odd biyearly
rhythms. Our proposed solution for this problem is time relaxation,
meaning that we allow equating connections with adjacent years. With
<code>time_relaxation = 1</code>, for example, we would allow
QuestionLink to harmonize responses from 1990 in Question C with those
from 1991 from question D. This may lead to some bias if constructs
change quickly over time. Often, however, the error is negligible.
Especially if we have many waves. After all, in the current setup we
would harmonize Question C ion 1990 not only to D in 1991 but also in
1899. Such symmetry will mitigate much of the bias introduced by time
mismatch.</p>
<p>We activate the feature by specifying it in <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>
as <code>time_relaxation = 1</code>:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>time_relaxation <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">QuestionLink Object Type: QuestionLink Prepare</span> <span style="color: #00BBBB;">──────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## Current stage of the QuestionLink workflow: <span style="font-weight: bold;">ql_prepare ✔</span> -&gt; ql_harmonize -&gt;</span></span>
<span><span class="co">## ql_transform</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Number of unique question combinations: <span style="color: #0000BB;">10</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Number of found connections:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Direct connections: <span style="color: #0000BB;">28</span></span></span></code></pre>
<pre><code><span><span class="co">## • Time relaxation connections: <span style="color: #0000BB;">72</span></span></span></code></pre>
<pre><code><span><span class="co">## • Relay connections: <span style="color: #0000BB;">0</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Additional information:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • No population variable supplied. Data is interpreted as comming from one</span></span>
<span><span class="co">## population.</span></span></code></pre>
<pre><code><span><span class="co">## • No weight variable was supplied.</span></span></code></pre>
<pre><code><span><span class="co">## For more information on the connections use summary().</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Note that we now have “Time relaxed connections” aside from the
“direct connections”. And indeed, we can now harmonize “C” and “D”. This
can be easily verified by using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. However, to save
space in this document, lets take a look directly at the relevant
table:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>time_relaxation <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">source_question</span>,<span class="va">target_question</span>,<span class="va">connection_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">connection_type</span>,</span>
<span>                       values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
direct
</th>
<th style="text-align:right;">
time_relaxation
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
22
</td>
</tr>
</tbody>
</table>
<p>Note how there is now a second column. Aside from <code>direct</code>
connections, we now also have <code>time_relaxation</code> connections.
The pattern of <code>NA</code>s also shows us that some instruments can
only be harmonized with direct, and others only with time relaxed
connections.</p>
</div>
<div class="section level4">
<h4 id="bridging-long-gaps-in-timeseries-with-use_relay">Bridging long gaps in timeseries with <code>use_relay</code><a class="anchor" aria-label="anchor" href="#bridging-long-gaps-in-timeseries-with-use_relay"></a>
</h4>
<p>Next, we want to bridge the gap between “A” and “B” by allowing
relays, or in equating lingo: “chained equating”. The idea is as
follows: We might not have a connection from “A” to “B”, but we have a
connection from “A” to “C” and from “C” to “B”. Thus we can use “C” as a
relay, by “chaining the equating”. This means nothing else as
transforming scores from “A” into the format of “C” and then onwards to
the format of “B”. We enable this with the <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>
argument <code>use_relay = TRUE</code>.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">QuestionLink Object Type: QuestionLink Prepare</span> <span style="color: #00BBBB;">──────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## Current stage of the QuestionLink workflow: <span style="font-weight: bold;">ql_prepare ✔</span> -&gt; ql_harmonize -&gt;</span></span>
<span><span class="co">## ql_transform</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Number of unique question combinations: <span style="color: #0000BB;">6</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Number of found connections:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Direct connections: <span style="color: #0000BB;">28</span></span></span></code></pre>
<pre><code><span><span class="co">## • Time relaxation connections: <span style="color: #0000BB;">0</span></span></span></code></pre>
<pre><code><span><span class="co">## • Relay connections: <span style="color: #0000BB;">96</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Additional information:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • No population variable supplied. Data is interpreted as comming from one</span></span>
<span><span class="co">## population.</span></span></code></pre>
<pre><code><span><span class="co">## • No weight variable was supplied.</span></span></code></pre>
<pre><code><span><span class="co">## For more information on the connections use summary().</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Note how the function now displays not only “direct connections” but
also “relay connections”. And indeed, if we look at the possible
connections again, we see that “A” and “B” can now be harmonized with
<code>relay</code> connections:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">source_question</span>,<span class="va">target_question</span>,<span class="va">connection_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">connection_type</span>,</span>
<span>                       values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
relay
</th>
<th style="text-align:right;">
direct
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
<p>If we allow <strong>both options</strong> at the same time, we get
all desired connections:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span> ,</span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">source_question</span>,<span class="va">target_question</span>,<span class="va">connection_type</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">connection_type</span>,</span>
<span>                       values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
relay
</th>
<th style="text-align:right;">
direct
</th>
<th style="text-align:right;">
time_relaxation
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
140
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
22
</td>
</tr>
</tbody>
</table>
<p>All that remains to do is to save the results into its own object for
the next step:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepared_connections</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span> ,</span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="ql_harmonize-calculating-the-harmonization-solutions">
<code>ql_harmonize</code> Calculating the harmonization
solutions<a class="anchor" aria-label="anchor" href="#ql_harmonize-calculating-the-harmonization-solutions"></a>
</h3>
<p>After finding all possible connections (i.e., opportunities for
harmonization via equating), we need to actually calculate all those
connections. To do this, we simply call <code>ql_harmonize</code> on the
ql_prepare object. Note that there are no additional attributes or
settings here. This is because all harmonization parameters were defined
in the prepare stage.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">&lt;-</span> <span class="va">prepared_connections</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Looking at the output, we see that we have now completed the second
of three steps towards our data harmonization!</p>
<p>Before we move on, let us take a quick look at the object that
<code>ql_harmonize</code> has created:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  'questionlink' chr "questionlink_object"</span></span>
<span><span class="co">##  - attr(*, "connections_rec_tbl")= tibble [1,610 × 13] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "summarized_rec_tbl")= tibble [100 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "data")= tibble [92,000 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "population_flag")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "weight_flag")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "scale_min_max")= list()</span></span></code></pre>
<p>We see that the object contains several components. Usually, we do
not need to deal with this level of details if we just want to harmonize
our data. Nonetheless, there are two components that are important to
understanding what <code>ql_harmonize</code> has done.</p>
<p>Firstly, <code>ql_harmonize</code> goes through every single
connection that we have found with <code>ql_prepare</code>. These are
stored in the attribute <code>connections_rec_tbl</code> within the
object created by <code>ql_harmonize</code>. Below we look at one such
connection (i.e., one row in <code>connections_rec_tbl</code> ):</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_connections</span> <span class="op">&lt;-</span> <span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; "><tbody>
<tr>
<td style="text-align:left;">
source_question
</td>
<td style="text-align:left;">
B
</td>
</tr>
<tr>
<td style="text-align:left;">
source_year
</td>
<td style="text-align:left;">
1980
</td>
</tr>
<tr>
<td style="text-align:left;">
source_population
</td>
<td style="text-align:left;">
dummy
</td>
</tr>
<tr>
<td style="text-align:left;">
target_question
</td>
<td style="text-align:left;">
C
</td>
</tr>
<tr>
<td style="text-align:left;">
target_year
</td>
<td style="text-align:left;">
1980
</td>
</tr>
<tr>
<td style="text-align:left;">
target_population
</td>
<td style="text-align:left;">
dummy
</td>
</tr>
<tr>
<td style="text-align:left;">
connection_type
</td>
<td style="text-align:left;">
direct
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_question
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_source_year
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_source_population
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_target_year
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_target_population
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
recoding_tables
</td>
<td style="text-align:left;">
list(source = 1:5, target = c(0.505931198102017, 0.699288256227758,
1.52481617647059, 3.2943661971831, 5.09836065573771))
</td>
</tr>
</tbody></table>
<p>In other words, each of the 1610 rows of that connection overview
contains details on the connection (e.g., which questions and what type
of connection) and most importantly: A recoding table with which to
harmonize the two instruments.</p>
<p>However, what we want is only one robust recoding table for each
instrument pair (“A” and “B”) in both directions (“A” -&gt; “B” &amp;
“B” -&gt; “A”). To this end, <code>ql_harmonize</code> condenses all
these 1610 down. Specifically, QuestionLink chooses the median
equivalent for each score across all harmonization solutions for a given
instrument pair and direction (e.g., “A” -&gt; “B”).</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_connections_A_B</span> <span class="op">&lt;-</span> <span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"B"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For example, there are 97 connections with which we can harmonize the
“source” question “A” towards the format of the “target” question “B”.
However, this is condensed down into exactly one recoding table in the
attribute <code>summarized_rec_tbl</code>:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"summarized_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"B"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:left;">
population
</th>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.861370
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.808081
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.510155
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.255409
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.969088
</td>
</tr>
</tbody>
</table>
<p>In practice, however, we do not need to delve manually into the
QuestionLink objects. Instead, we can easily apply the recoding tables
with the next function: <code>ql_transform</code>.</p>
</div>
<div class="section level3">
<h3 id="ql_transform-recoding-the-response-data">
<code>ql_transform</code> Recoding the response data<a class="anchor" aria-label="anchor" href="#ql_transform-recoding-the-response-data"></a>
</h3>
<p>With <code>ql_transform</code> we can recode our data along the
equating solutions that QuestionLink has found.</p>
<p>This process only requires us to make two decisions: (1) Which
question do we want to harmonize towards and (2) what data do we want to
harmonize?</p>
<div class="section level4">
<h4 id="which-question-to-harmonize-towards">1. Which question to harmonize towards?<a class="anchor" aria-label="anchor" href="#which-question-to-harmonize-towards"></a>
</h4>
<p>QuestionLink harmonizes questions so that they can be interpreted in
the format of a target question. In other words, we want to estimate
what respondents would have chosen in the target question based on the
response they gave to another question for the same concept. Of course
different questions and their response options are never a perfect
match. Instead, we try to find a decimal value that best positions a
response to one question in the scale determined by the target
question.</p>
<p>This is perhaps easier to understand visually with an example drawn
from the <a href="https://www.gesis.org/en/services/processing-and-analyzing-data/data-harmonization/question-link/political-interest" class="external-link">harmonized
questions for political drawn from QuestionLink</a>:</p>
<p><img src="figures/QL_equating_example.svg"></p>
<p>Here we harmonize a question on political interest from the ISSP
survey program to a question on political interest from the ALLBUS
survey program. Note how “very interested” in the ISSP question is not
equivalent to “very strongly” in the ALLBUS question. Instead,
respondents who chose “very interested” in the ISSP would have either
chosen “very strongly” or “strongly” in the ALLBUS. The median
equivalent value <code>1.63</code> can thus be understood as about
halfway between the concept intensity of the response scores
<code>1</code> and <code>2</code> in the target question.</p>
<p>It is important to note that decision for a target question is mainly
one of what is easiest to understand for you, for your colleagues, for
reviewers, and for your eventual readers. Equating solutions are
symmetrical, meaning that the relationship “A” -&gt; “B” is the same as
“B” -&gt; “A”. Of course the recoding tables look different, but the
underlying mathematical relationship formed by equating is the same.</p>
</div>
<div class="section level4">
<h4 id="what-data-do-you-want-to-harmonize">2. What data do you want to harmonize?<a class="anchor" aria-label="anchor" href="#what-data-do-you-want-to-harmonize"></a>
</h4>
<p>QuestionLink allows you to either harmonize the data you use for
equating or to harmonize different data with the solutions you have
calculated.</p>
<p>The most convenient case is <strong>harmonizing data that lends
itself to equating</strong>. This means your combined data has
sufficient equating opportunities (i.e., direct, time-relaxed, and relay
connections) to harmonize all questions towards your chosen target
question. It is important to realize that not all data points (e.g., all
waves) need to have connections. You just need some connections between
all questions to harmonize the whole dataset in one go.</p>
<p>This is done by applying the <code><a href="../reference/ql_transform.html">ql_transform()</a></code> function
directly to the harmonization solution generated by
<code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code>, like so:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_transform.html">ql_transform</a></span><span class="op">(</span>target_question <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># Note that we harmonize towards "A"</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
question
</th>
<th style="text-align:right;">
response
</th>
<th style="text-align:right;">
weight
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1990
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
3.539771
</td>
</tr>
<tr>
<td style="text-align:right;">
1982
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.311533
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
3.539771
</td>
</tr>
<tr>
<td style="text-align:right;">
1992
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
4.132169
</td>
</tr>
<tr>
<td style="text-align:right;">
2010
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.000000
</td>
</tr>
<tr>
<td style="text-align:right;">
1984
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.311533
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
1.715738
</td>
</tr>
<tr>
<td style="text-align:right;">
1988
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.311533
</td>
</tr>
<tr>
<td style="text-align:right;">
2008
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
4.132169
</td>
</tr>
<tr>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.311533
</td>
</tr>
</tbody>
</table>
<p>The newly harmonized response values can be found in the column
“median_equivalent”. If a data point was already measured with the
target question (here “A”), then the value is simply copied (e.g., a “3”
stays a “3”).</p>
<p>In some projects, however, we might have <strong>data with no
connections between some questions</strong>. This might be because there
is no time overlap (e.g., same year) for some questions and no relay
connection to compensate for it. It might also happen because our data
is comprised of separate non-probability samples where we cannot say
that the samples measure the same population. We will discuss such
issues more in the section “Advanced use cases”. For now, we just
imagine a setup where we have two pooled data sets. One with the
necessary connections (e.g., our simulated example data) and another
pooled data set that we actually want to harmonize to do research with
it. Thus we call those two pooled data sets harmonization data and
research data in the following example.</p>
<p><strong>Preparing harmonization and research data:</strong></p>
<p>Note how the research data only requires the columns
<code>source_question</code> and <code>response</code>. The contents of
<code>source_question</code> must match the question names in the
harmonization data.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_data</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span></span>
<span></span>
<span><span class="va">research_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="cn">NA</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Randomize score order</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"source_question"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">research_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:right;">
response
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p><strong>Using the harmonization data to harmonize the research
data:</strong></p>
<p>Here we see how easy it is to introduce our research data by
providing it as the <code>new_data</code> argument to
<code><a href="../reference/ql_transform.html">ql_transform()</a></code>. All the function then does is to add three
columns: <code>target_question</code>, <code>population</code>, and the
recoded responses as <code>median_equivalent</code>. Also note that
while missing values have to be removed from the harmonization data,
they are no problem in the research data. <code>ql_transform</code>
simply preserves these missings in the harmonized solution.</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonized_research_data</span> <span class="op">&lt;-</span> <span class="va">harmonization_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>time_relaxation <span class="op">=</span> <span class="fl">1</span>, </span>
<span>             use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># harmonize with harmonization data</span></span>
<span>  <span class="fu"><a href="../reference/ql_transform.html">ql_transform</a></span><span class="op">(</span></span>
<span>    target_question <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>    new_data <span class="op">=</span> <span class="va">research_data</span><span class="op">)</span> <span class="co"># introduce the research data</span></span>
<span></span>
<span><span class="va">harmonized_research_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:right;">
response
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
3.539771
</td>
</tr>
<tr>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
3.341577
</td>
</tr>
<tr>
<td style="text-align:left;">
D
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
1.590504
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.000000
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.311533
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="helper-functions">05 Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h2>
<p>We added three helper functions to the QuestionLink Package for your
convenience.</p>
<ol style="list-style-type: decimal">
<li>The method for <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> which provides more
information on our harmonization data. We already used that method in
the section “ql_prepare Finding harmonization connections”.</li>
<li>A method for <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, with which you can plot the time
series and opportunities for harmonization.</li>
<li>The function <code><a href="../reference/ql_check.html">ql_check()</a></code>, which validates the data we
provided for <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>.</li>
</ol>
<p>Since all helper features use the object created by
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>, it is often a good idea to save the results
of <code>ql_repare()</code> into a variable and examine it before
progressing further:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="summary-summarising-the-harmonization-data">
<code>summary()</code> Summarising the harmonization data<a class="anchor" aria-label="anchor" href="#summary-summarising-the-harmonization-data"></a>
</h3>
<p>As shown earlier, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> used on a
<code>ql_prepare</code> object leads to an extended version of just
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>ing the object. This is always a good first
step.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary: QuestionLink Prepare</span> <span style="color: #00BBBB;">───────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## Current stage of the QuestionLink workflow: <span style="font-weight: bold;">ql_prepare ✔</span> -&gt; ql_harmonize -&gt;</span></span>
<span><span class="co">## ql_transform</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Number of unique question combinations: <span style="color: #0000BB;">12</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Number of found connections:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Direct connections: <span style="color: #0000BB;">28</span></span></span></code></pre>
<pre><code><span><span class="co">## • Time relaxation connections: <span style="color: #0000BB;">72</span></span></span></code></pre>
<pre><code><span><span class="co">## • Relay connections: <span style="color: #0000BB;">1510</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Additional information:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • No population variable supplied. Data is interpreted as comming from one</span></span>
<span><span class="co">## population.</span></span></code></pre>
<pre><code><span><span class="co">## • No weight variable was supplied.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over question combinations:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Source question   Target question    Direct   Time relaxation   Relay</span></span>
<span><span class="co">## ----------------  ----------------  -------  ----------------  ------</span></span>
<span><span class="co">## A                 C                       8                NA     140</span></span>
<span><span class="co">## C                 A                       8                NA     140</span></span>
<span><span class="co">## B                 C                       6                NA     140</span></span>
<span><span class="co">## C                 B                       6                NA     140</span></span>
<span><span class="co">## A                 B                      NA                NA      97</span></span>
<span><span class="co">## A                 D                      NA                 7     169</span></span>
<span><span class="co">## B                 A                      NA                NA      97</span></span>
<span><span class="co">## B                 D                      NA                 7     125</span></span>
<span><span class="co">## C                 D                      NA                22      84</span></span>
<span><span class="co">## D                 A                      NA                 7     169</span></span>
<span><span class="co">## D                 B                      NA                 7     125</span></span>
<span><span class="co">## D                 C                      NA                22      84</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over response options found:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Question   Response options                User supplied </span></span>
<span><span class="co">## ---------  ------------------------------  --------------</span></span>
<span><span class="co">## A          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## B          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## C          1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## D          1, 2, 3, 4, 5, 6, 7, 8, 9, 10   FALSE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plot-plotting-of-time-series">
<code>plot()</code> Plotting of time series<a class="anchor" aria-label="anchor" href="#plot-plotting-of-time-series"></a>
</h3>
<p>If we call <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on a <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> object,
we receive an overview of the time series for each question. This
overview also show us, which questions can be harmonized with
QuestionLink. If the question is connected “to all” in green, then we
can harmonize all other questions to that question as a target. If the
question is connected “to some” in yellow then we can harmonize some but
not all other questions to that question as a target. If a question is
connected “to none” in red, then this question cannot be harmonized with
QuestionLink.</p>
<p>In practice, this means we can harmonize all questions if at least
one question is connected “to all”. If we then choose this question as
the target question, then all questions are harmonized (even if they
themselves are only connected “to some”)! There will be a clear example
for this in the article on advanced use cases under the section <a href="https://matroth.github.io/questionlink/articles/advanced_use_cases#choosing-the-right-target-question">choosing
the right target question</a>.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_object</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="questionlink_tutorial_files/figure-html/unnamed-chunk-50-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="ql_check-assessing-the-harmonization-data">
<code>ql_check()</code> Assessing the harmonization data<a class="anchor" aria-label="anchor" href="#ql_check-assessing-the-harmonization-data"></a>
</h3>
<p>The <code><a href="../reference/ql_check.html">ql_check()</a></code> function performs a number of checks on
the data read into <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>. However, if we apply it to
our simulated data set with its synthetic perfection, all we get are
valid check-marks for all four questions.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>So we have to break our data to showcase <code><a href="../reference/ql_check.html">ql_check()</a></code>.</p>
<p><strong>Not all response between minimum and maximum
used</strong></p>
<p>If a scale has possible responses from 1 to 5, it is not impossible,
but unlikely that there are no respondents who chose a 3. Thus,
<code><a href="../reference/ql_check.html">ql_check()</a></code> throws us a warning “Not all response options
between the minimum and maximum of <em>Question</em> were used” and then
details the year(s) in which that was the case. To show this, we filter
all cases where respondents chose 3 to question B:</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">&amp;</span> <span class="va">response</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At this point you might ask how QuestionLink knows what the minimum
and maximum score of each question is. In our case, it infers that
information empirically from the data. However, a cleaner way is to
provide such response scale information as meta-data to
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>. This will be covered in the “advanced use
cases” section.</p>
<p><strong>Multiple Versions of <em>question</em> were
found</strong></p>
<p>The next way to break our data is by deleting all responses of 5 from
question C, but only in one year (1980). As it happens, 5 is also the
maximum score of C. This triggers the warning “multiple Versions of C
were found”. <code>ql_check</code> then details the two “versions” of C
it found. One version with the values 1, 2, 3, 4 and another version
with the values 1, 2, 3, 4, 5. It also lists the respective years. This
way we can easily find instances where we read in invalid values, for
example.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1980</span> <span class="op">&amp;</span> <span class="va">question</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">&amp;</span> <span class="va">response</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><strong>Negative responses were found</strong></p>
<p>A special case are negative values. There are some cases where
negative response values are actually valid. For example, response
scales centered around zero, such as -2, -1, 0, 1, 2. However, it is far
more likely that the negative value is a missing value code (e.g., -99).
Below we replace the response 1 in question C with -99. This causes a
new warning: “Negative responses were found for C”. In such cases it is
best to carefully reexamine the values in your harmonization data with
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and by looking into the respective survey
documentation of your data sources.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">&amp;</span> <span class="va">response</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>    <span class="op">-</span><span class="fl">99</span>, <span class="va">response</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthias Roth, Ranjit Konrad Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
