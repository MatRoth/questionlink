<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="questionlink">
<title>Advanced Use Cases • questionlink</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Use Cases">
<meta property="og:description" content="questionlink">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">questionlink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_use_cases.html">Advanced Use Cases</a>
    <a class="dropdown-item" href="../articles/questionlink_tutorial.html">QuestionLink Tutorial</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MatRoth/questionlink/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="advanced_use_cases_files/kePrint-0.0.1/kePrint.js"></script><link href="advanced_use_cases_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Advanced Use Cases</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MatRoth/questionlink/blob/HEAD/vignettes/advanced_use_cases.rmd" class="external-link"><code>vignettes/advanced_use_cases.rmd</code></a></small>
      <div class="d-none name"><code>advanced_use_cases.rmd</code></div>
    </div>

    
    
<p>This article covers more advanced use cases as well as details of how
the QuestionLink package works. You can quickly navigate to relevant
topics with the table of contents on the left.</p>
<p>If you have not already, we suggest working through the <a href="https://matroth.github.io/questionlink/articles/questionlink_tutorial.html">QuestionLink
tutorial</a> first.</p>
<p>The code below simulates response data for four questions which all
capture the same construct in a population. This process is explained in
detail in the tutorial. This simulated dataset will be used in the code
examples later on.</p>
<details><summary>
Data simulation code (click to unfold)
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Loading necessary packages</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'kableExtra'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     group_rows</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: viridisLite</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Installing questionlink with devtools</span></span>
<span><span class="co">#devtools::install_github("https://github.com/MatRoth/questionlink")</span></span>
<span><span class="co">## Installing questionlink with pak</span></span>
<span><span class="co">##install.packages("pak")</span></span>
<span><span class="co">#pak::pak("https://github.com/MatRoth/questionlink")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://matroth.github.io/questionlink/">questionlink</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># Defining Custom functions</span></span>
<span></span>
<span><span class="va">format_table</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>      full_width <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_question_years</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">combined_df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">year_min</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">combined_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>  <span class="va">year_max</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">combined_df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span>  <span class="va">years_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">year_min</span><span class="op">:</span><span class="va">year_max</span><span class="op">)</span></span>
<span>  <span class="va">major_breaks_vec</span> <span class="op">=</span> <span class="va">years_vec</span><span class="op">[</span><span class="va">years_vec</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">5</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">combined_df</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>question <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span>, color <span class="op">=</span> <span class="va">question</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">major_breaks_vec</span>,</span>
<span>                       minor_breaks <span class="op">=</span> <span class="va">years_vec</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># helper function that allows us to cut continuous values into ordinal chunks</span></span>
<span><span class="va">cut_responses</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">breaks</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ord_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="va">breaks</span>, <span class="cn">Inf</span><span class="op">)</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ord_vec</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># ------------------</span></span>
<span><span class="co"># Simulating response data for four different questions for the same construct in the same population</span></span>
<span><span class="co"># ------------------</span></span>
<span></span>
<span><span class="co"># Parameters of the simultation</span></span>
<span></span>
<span><span class="co">## Sample size per simulated survey wave</span></span>
<span><span class="va">survey_sample_n</span> <span class="op">=</span> <span class="fl">2000</span></span>
<span></span>
<span><span class="co">## Response thresholds for the four simulated survey questions</span></span>
<span><span class="va">response_thresholds_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">response_thresholds_B</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">response_thresholds_A</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span><span class="va">response_thresholds_C</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">response_thresholds_A</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.7</span></span>
<span><span class="va">response_thresholds_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span>,</span>
<span>  <span class="co"># construct linearly increases over time</span></span>
<span>  target_construct_mean <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">0.5</span>, </span>
<span>  simulated_true_score <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">target_construct_mean</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">survey_sample_n</span>, <span class="va">.x</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">simulated_true_score</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> <span class="co"># Cut simulated true score into ordinal responses for Questions A to D</span></span>
<span>    question_A <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_A</span><span class="op">)</span>,</span>
<span>    question_B <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_B</span><span class="op">)</span>,</span>
<span>    question_C <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_C</span><span class="op">)</span>,</span>
<span>    question_D <span class="op">=</span> <span class="fu">cut_responses</span><span class="op">(</span><span class="va">simulated_true_score</span>, <span class="va">response_thresholds_D</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Bringing the simulated data into long format</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span>   <span class="va">sim_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"question"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"question"</span><span class="op">)</span>, values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">name</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"discard"</span>, <span class="st">"question"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">discard</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Introducing gaps in the time series for the questions</span></span>
<span></span>
<span><span class="co">## Questions A, B, and C get survey waves in even years, D in odd years</span></span>
<span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"C"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"D"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Defining larger gaps in time series by defining the "possible years" for each question</span></span>
<span></span>
<span><span class="va">possible_years_lists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span>,</span>
<span>  D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1985</span><span class="op">:</span><span class="fl">2005</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">qlink_format_df</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valid_year <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_lgl</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">possible_years_lists</span><span class="op">[[</span><span class="va">.y</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">valid_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valid_year</span><span class="op">)</span></span></code></pre></div>
</details><p>We simulate data from 1980 to 2020 with deliberate gaps in the time
series for each question so that we can showcase the purpose of
QuestionLink.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_question_years</span><span class="op">(</span><span class="va">qlink_format_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We also prepare a harmonization solution with QuestionLink, since we
will explore the resulting object in greater detail in this article.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a ql_prepare() object with the harmonization opportunities</span></span>
<span></span>
<span><span class="va">prepared_connections</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span> ,</span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creating a ql_harmonize() object with the calculated harmonization solutions</span></span>
<span></span>
<span><span class="va">harmonization_solution</span> <span class="op">&lt;-</span> <span class="va">prepared_connections</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="inverted-items">Inverted items<a class="anchor" aria-label="anchor" href="#inverted-items"></a>
</h2>
<p>When combining data from different sources with their own question
versions for a concept of interest, we often encounter the issue that
not all questions measure the concept in the same numerical order. Some
questions represent stronger expression of the concept with higher
numerical scores, while other questions are inverted in the sense that
higher numerical scores mean weaker expressions of the concept.</p>
<p>Imagine two questions for social trust; both with 5 response options.
However, in one scale “1” is the lowest level of trust and “5” is the
highest level of trust. Meanwhile, in the other scale “1” is the highest
level of trust and “5” is the lowest level of trust. This is an obstacle
to pooling and harmonizing the data!</p>
<p>This issue of inverted items can stem from two different causes:</p>
<p><span class="math inline">\(1\)</span> Response scales with different
directions can lead to different scale “orientations”.</p>
<p>For example: <span class="math display">\[fully agree\]</span> …
<span class="math display">\[do not agree at all\]</span> versus <span class="math display">\[do not agree at all\]</span> … <span class="math display">\[fully agree\]</span></p>
<p><span class="math inline">\(2\)</span> The question wording is
different in relation to the concept. This is sometimes discussed as
“negative” or “reversed” items.</p>
<p>For example: “All in all, I trust other people” versus “All in all, I
do not trust other people.”</p>
<div class="section level3">
<h3 id="resolving-inverted-items-during-harmonization">Resolving inverted items during harmonization<a class="anchor" aria-label="anchor" href="#resolving-inverted-items-during-harmonization"></a>
</h3>
<p>For the QuestionLink package, we decided to leave item inversion up
to the users beforehand. <strong>This means you need to recode items
before feeding the data into <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>.</strong></p>
<p>You might wonder why the package does not automate this process. This
would be fairly easy to implement, but would require users to add
additional meta-data on each question. Specifically, one would have to
specify inverted items in a separate data structure or as another
column. We thus found it best to leave this step up to users before
applying the package so as not to add an unnecessary layer of complexity
to the package usage.</p>
<p>As best practice, we would recommend inverting response scores of
questions that do not match the orientation of the chosen target
question. That way, scores can in the end be interpreted in line with
the scale of the target question. If there are no other considerations
to be made, we would also recommend choosing a target question that
follows the heuristic “higher means more” or “better”. That way all
analyses with the harmonized data become easier to interpret.</p>
<p>Inverting items is a trivial matter in R:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">invert_item</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">responses</span>, </span>
<span>                         <span class="va">min_score</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">responses</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span>
<span>                         <span class="va">max_score</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">responses</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span> </span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">responses</span></span>
<span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">v</span><span class="op">-</span><span class="op">(</span><span class="va">min_score</span> <span class="op">+</span> <span class="va">max_score</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For example for a 5-point scale:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">invert_item</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5 4 3 2 1</span></span></code></pre>
<p>However, it is often better to clearly specifiy the minimum and
maximum scores. That way, the function works even in data sets where
respondents did not use the full scale. Consider again a 5-point
scale:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#wrong:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">invert_item</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5 4 3 2</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#correct:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">invert_item</span><span class="op">(</span>min_score <span class="op">=</span> <span class="fl">1</span>, max_score <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 3 2 1</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h2>
<p>Many survey programs provide weights in their scientific use files.
Weights are generally provided when surveys are based on probability
samples of a population. In such cases, weights are often included in
analyses with the survey data to correct for some aspects of this
sampling.</p>
<p><strong>Design weights</strong> correct for conscious sample design
decisions. In Germany, for example, some survey programs “oversample”
the federal states of former East Germany. This means surveys such as
the ALLBUS recruit proportionally more respondents in these states to
increase the statistical resolution there. However, to avoid skewing
analyses, this has to be addressed with a design weight.</p>
<p><strong>Adjustment weights</strong>, meanwhile, correct for sampling
issues that were not intended, such as unit non-response. Often, this
involves weighting the data set so that it aligns better to the
socio-demographic distribution of the target population (i.e.,
post-stratification).</p>
<p>Since QuestionLink harmonizes questions based on their frequency
distribution in a specific population, we need to apply weights to get
as close as possible to representing the “same” population. To this end,
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> can process an additional column in the
combined data set that we feed into it.</p>
<p>Aside from <code>year</code>, <code>question</code>, and
<code>response</code> we simply add another column called
<code>weight</code>. In this column, we provide the weights from
different sources. We would routinely recommend using the design weight
if provided, but adding adjustment weights can also be a sound choice
depending on your field and the assumptions you are comfortable
with.</p>
<p>Weights in the scientific use files of survey programs can also vary
in the way they are scaled. Some weights result in frequency
distributions as they would have been in the total target population.
However, we would recommend using <strong>rescaled weights</strong> that
are standardized to the sample size of each survey wave. You can easily
identify these weights by calculating the mean in each wave. Weights
that are rescaled to represent the sample size should always have a mean
of exactly 1.</p>
<p>If you want to use <strong>design and adjustment weights at the same
time</strong>, you can simply multiply the rescaled weights and enter
their product as the <code>weight</code> column into
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="missing-values-and-non-substantive-responses">Missing values and non substantive responses<a class="anchor" aria-label="anchor" href="#missing-values-and-non-substantive-responses"></a>
</h2>
<p>In many survey data sets, we find that some response values are
missing. As mentioned earlier, when preparing data to be passed into
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>, we remove missing values first. Such missing
values are often either actual missing responses (e.g., due to omissions
or refusals) or non-substantive responses, such as “don’t know”. In many
survey contexts, such cases are few and should not impact the quality of
the harmonization solution overly much.</p>
<p>Nonetheless, under certain circumstances we recommend taking a closer
look:</p>
<ol style="list-style-type: decimal">
<li>If there are many missing values, the issue becomes more
pressing.</li>
<li>If the proportion of missing values varies considerably between
source surveys, it might mean that surveys differ systematically in how
respondents behave.</li>
<li>Sometimes, some source surveys offer non-substantive response
options while others do not.</li>
</ol>
<p>In such cases, you need to consider that QuestionLink assumes that
the probability of having a missing response value is either
statistically independent from the measured concept or that biases are
at least the same across all data sources. Another way of looking at the
same issue is this: If you could look into the heads of the missing
value respondents for every question, we should find the same
distribution of the true construct scores for participants with valid
responses across all questions.</p>
<p>These issues perhaps become clearer with two practical examples.</p>
<p>Imagine respondents who omit answers out of embarrassment; for
example if they hold an opinion they think is seen as unpopular or even
immoral. That is, in itself, not yet a problem for QuestionLink as long
as the same problem persists across all questions. However, now imagine
that one question is more subtle while the other question is very
direct. In such cases, respondents with strong beliefs might respond to
one question but would omit the other. In such cases, the two underlying
populations are no longer the same in terms of the distribution of true
scores (i.e., what people truly believe). And this would bias the
harmonization solution.</p>
<p>Another example are two questions where only one features a
non-substantive “don’t know” option. That is in itself not a problem, as
long as people who would have chosen “don’t know” pick a random
substantive response option if they are forced to choose. However, if
respondents choose a midpoint category as a way of expressing “don’t
know” if they do not get that option, then the distributions are again
biased.</p>
<p>If you are concerned about systematic missing values, you might
consider analyzing the pattern of missing values. For example, by
looking at the demographic distribution of responses with missing
responses. Those should be similar across data sources if missing
responses are random or the result of a similar mechanism across
sources. A potential solution for missing values is to
<strong>impute</strong> them before handing the responses over to
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>. However, note that this only works if the
reason of missingness is reflected in other variables. In technical
terms: QuestionLink assumes that missings are completely at random
(MCAR). With careful imputation, we can mitigate this assumption down to
the less restrictive missing at random (MAR) assumption. This is the
case when responses are not missing randomly, but any systematic pattern
of missing values can be explained with other variables in the dataset.
However, even imputation cannot resolve responses that are missing not
at random (MNAR). For a quick introducution into these types of
missingness, <a href="https://en.wikipedia.org/wiki/Missing_data#Types" class="external-link">see
Wikipedia</a>.</p>
<p>Lastly, for clarification: Missing values are a problem in the
harmonization data; i.e., the data handed to <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>
to calculate the harmonization solutions. However, they are no problem
when we want to harmonize data with <code><a href="../reference/ql_transform.html">ql_transform()</a></code> using a
previously established harmonization solution.</p>
</div>
<div class="section level2">
<h2 id="ensuring-data-integrity-with-documentation-meta-data">Ensuring data integrity with documentation meta-data<a class="anchor" aria-label="anchor" href="#ensuring-data-integrity-with-documentation-meta-data"></a>
</h2>
<p>In our examples up until now, QuestionLink simply inferred the
response scale of each question from the supplied data. Specifically, it
infers the minimum and maximum response scale from what it finds in the
pooled harmonization data. However, this can be dangerous in some
cases.</p>
<p>One example are zeros as responses. In some cases, zeros are valid
responses, for example in 11-point scales from 0 to 10. In other cases,
zeros can be undeclared missing values, for example when response
options were omitted in a web survey. Of course, the summaries in
<code>ql_prepare |&gt; summary()</code> and in
<code>ql_prepare |&gt; check()</code> can reveal such issues. However,
we recommend that you clearly define each response scale minimum and
maximum for each question. This also means reviewing the documentation
of your source surveys carefully.</p>
<p>Once you have this information, you can easily supply it to
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> with a list. This then informs the
<code><a href="../reference/ql_check.html">ql_check()</a></code> function and leads to more reliable data
validation checks.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_max_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"D"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Consider the following example. First, we delete all values of 10
from instrument “D” to corrupt our data.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrupted_data</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">question</span> <span class="op">==</span> <span class="st">"D"</span> <span class="op">&amp;</span> <span class="va">response</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then we run <code><a href="../reference/ql_check.html">ql_check()</a></code> without providing additional
scale information:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrupted_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">A ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">B ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">C ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">D ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<p>Despite our corrupted data, we get no warning. As far as
<code><a href="../reference/ql_check.html">ql_check()</a></code> is concerned, question D is not a 9-point
scale.</p>
<p>However, if we provide the scale information, <code><a href="../reference/ql_check.html">ql_check()</a></code>
now spots the inconsistency!</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_max_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"A"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"B"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"C"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"D"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">corrupted_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    scale_min_max <span class="op">=</span> <span class="va">min_max_list</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_check.html">ql_check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">A ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">B ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">C ✔</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">D</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Issue:</span> Not all response options between the minimum (1) and maximum (10) of D</span></span>
<span><span class="co">## were used.</span></span></code></pre>
<pre><code><span><span class="co">## Year(s): 1985, 1987, 1989, 1991, 1993, 1995, 1997, 1999, 2001, 2003, 2005</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
</div>
<div class="section level2">
<h2 id="retrieving-recoding-tables">Retrieving recoding tables<a class="anchor" aria-label="anchor" href="#retrieving-recoding-tables"></a>
</h2>
<p>QuestionLink makes it unnecessary to handle recoding tables manually.
However, for purposes of transparency or to document the solutions in
papers it might become necessary to access the recoding tables.</p>
<p>To do so, we will delve manually into the output object of
<code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code>. To get a quick overview that that object
type (or any other object) contains, you can use <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code>. We
will use the “attributes” <code>summarized_rec_tbl</code> and
<code>connections_rec_tbl</code>. You can imagine these attributes as
containers nested inside the larger object.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span>max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  'questionlink' chr "questionlink_object"</span></span>
<span><span class="co">##  - attr(*, "connections_rec_tbl")= tibble [1,610 × 13] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "summarized_rec_tbl")= tibble [100 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "data")= tibble [92,000 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  - attr(*, "population_flag")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "weight_flag")= logi FALSE</span></span>
<span><span class="co">##  - attr(*, "scale_min_max")= list()</span></span></code></pre>
<div class="section level3">
<h3 id="retrieving-the-aggregated-recoding-tables">Retrieving the aggregated recoding tables<a class="anchor" aria-label="anchor" href="#retrieving-the-aggregated-recoding-tables"></a>
</h3>
<p>The most likely use case is that you want to access the final,
aggregated recoding table that QuestionLink has formed from all
available connections. This can be easily done by picking the recoding
information from the <code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code> object. To access this,
apply <code>|&gt; attr("summarized_rec_tbl")</code> to a
<code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code> object. This results in a dataframe with all
recoding tables in one data frame.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a ql_harmonize object:</span></span>
<span><span class="va">harmonization_solution</span> <span class="op">&lt;-</span> <span class="va">qlink_format_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"summarized_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:left;">
population
</th>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.8861928
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.8196067
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3.5077829
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.2727473
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.9899307
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.6440319
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.2874516
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.4947831
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.8491165
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.1223823
</td>
</tr>
</tbody>
</table>
<p>If you want the recoding information for a specific pair of
questions, simply filter that data frame:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Looking up recodings from "A" to "C"</span></span>
<span></span>
<span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"summarized_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"C"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">population</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.6440319
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.2874516
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.4947831
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.8491165
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.1223823
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="retrieving-all-recoding-tables-that-were-calculated">Retrieving all recoding tables that were calculated<a class="anchor" aria-label="anchor" href="#retrieving-all-recoding-tables-that-were-calculated"></a>
</h3>
<p>If you will recall, QuestionLink calculates all possible equating
solutions (and thus recoding tables). This means it will calculate one
recoding table per found, allowed (direct, time-relaxed, or relay)
connection .</p>
<p>Accessing these recoding tables can make sense if you want to assess
the variability of the separate equatings. This can be interesting for
methodological research or to identify problems with specific data
sources or across time.</p>
<p>Specifically, <code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code> objects contain a data
frame in the attribute <code>connections_rec_tbl</code>, which contains
all connections between the questions and for each connection the
equating solution in the form of a recoding table.</p>
<p>A quick look into that data frame shows that it contains a number of
variables:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble_col</a></span><span class="op">(</span>column_name <span class="op">=</span> <span class="st">"variable names"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
variable names
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
source_question
</td>
</tr>
<tr>
<td style="text-align:left;">
source_year
</td>
</tr>
<tr>
<td style="text-align:left;">
source_population
</td>
</tr>
<tr>
<td style="text-align:left;">
target_question
</td>
</tr>
<tr>
<td style="text-align:left;">
target_year
</td>
</tr>
<tr>
<td style="text-align:left;">
target_population
</td>
</tr>
<tr>
<td style="text-align:left;">
connection_type
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_question
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_source_year
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_source_population
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_target_year
</td>
</tr>
<tr>
<td style="text-align:left;">
relay_target_population
</td>
</tr>
<tr>
<td style="text-align:left;">
recoding_tables
</td>
</tr>
</tbody>
</table>
<p>Let us go through these step by step. In general, all variables
describe a connection from one question to another. The last variable,
<code>recoding_tables</code> then gives the equating solution for that
specific connection.</p>
<ol style="list-style-type: decimal">
<li>The first three variables, <code>source_question</code>,
<code>source_year</code>, &amp; <code>source_population</code>, denote
the <strong>source question</strong> (and its specific data source in
terms of year and population); that is the question we want to
harmonize. For example, the row might harmonize question “A” with data
gathered in 1992 from Germany towards some other question format.</li>
<li>The next three variables, <code>target_question</code>,
<code>target_year</code>, &amp; <code>target_population</code>, denote
the <strong>target question</strong> (and its specific data source in
terms of year and population); that is the question we want to use as
the target scale format for our harmonization. For example, the row
might harmonize the source question towards the format of question “B”
with data gathered in 1992 from Germany.</li>
<li>
<code>connection_type</code> then denotes the <strong>type of
connection</strong> that was used in this connection instance to
harmonize the source question towards the format of the target question.
The three possible types are <code>direct</code>,
<code>time_relaxation</code>, and <code>relay</code>. Of course,
<code>time_relaxation</code>, and <code>relay</code> connections only
appear in the data frame if we allowed these two types of connections
during the <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> stage of our harmonization.</li>
<li>The next five variables all detail a <strong>relay</strong> used for
harmonization and can be ignored if you are not interested in this
specifically. Of course these variables only have valid values if the
connection is of the type <code>relay</code>. If you remember our data
example, there were no direct or time-relaxed connections between
questions “A” and “B”. Thus we harmonize “A” to “B” via the relay
question “C”. In such a case, the relay variables for this connection
would be filled with information on which <code>relay_question</code>
was used (e.g., “C”), which <code>relay_source_year</code> and
<code>relay_source_population</code> instance was used to harmonize the
source question to (e.g., “A” to “C”), and lastly, which
<code>relay_target_year</code> and <code>relay_target_population</code>
instance was used to harmonize the equating solution onwards to the
target question (e.g., “C” to “A”).</li>
<li>Last but not least, <code>recoding_tables</code> contain the
equating solutions for each connection. This is where we need to get our
recoding tables from.</li>
</ol>
<p>The content of each cell in the column <code>recoding_tables</code>
is itself a nested table.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">recoding_tables</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
target
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.5095352
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.6853397
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.4916567
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.2657895
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.1397059
</td>
</tr>
</tbody>
</table>
<p>We chose this “nested” structure, because it means that we get a “one
row, one connection” data frame. For our purposes, however, we might
want to <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> that structure so that one row is one
source question score harmonized with a specific connection.</p>
<p>Consider one row (omitting the relay variables for brevity):</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"relay"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:right;">
source_year
</th>
<th style="text-align:left;">
source_population
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
target_year
</th>
<th style="text-align:left;">
target_population
</th>
<th style="text-align:left;">
connection_type
</th>
<th style="text-align:left;">
recoding_tables
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:left;">
1.0000000, 2.0000000, 3.0000000, 4.0000000, 5.0000000, 0.5095352,
0.6853397, 1.4916567, 3.2657895, 5.1397059
</td>
</tr></tbody>
</table>
<p>Now observe hpw <code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> unfolds this one row into five
rows; one for each of the five possible response options of the source
question B. This also adds the columns <code>source</code> for the
source questions scores, and <code>target</code> for the harmonized
scores towards the target questions format.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"relay"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">recoding_tables</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:right;">
source_year
</th>
<th style="text-align:left;">
source_population
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
target_year
</th>
<th style="text-align:left;">
target_population
</th>
<th style="text-align:left;">
connection_type
</th>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
target
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.5095352
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.6853397
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.4916567
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3.2657895
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
dummy
</td>
<td style="text-align:left;">
direct
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5.1397059
</td>
</tr>
</tbody>
</table>
<p>If you are interested in the variability of equating solutions
between to questions, for example over time, you can simply
<code><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest()</a></code> and then <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> the dataframe.</p>
<p>As an example, we look at all the <code>direct</code> connection
between “A” and “C”. The plot shows source scores of question “A” on the
x-axis and the calculated equivalents in the target format of “C” on the
y-axis. Note how there are several “target” equivalent values for each
“source” score. Specifically, one equivalent for each score per direct
connection. However, they are very similar across all those direct
connections. (This will look messier an empirical data!)</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>connection_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"C"</span>,</span>
<span>    <span class="va">connection_type</span> <span class="op">==</span> <span class="st">"direct"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">recoding_tables</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">source</span>,<span class="va">target</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">connection_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Now we repeat this plot, but this time with all <code>relay</code>
connections. We immediately see that (1) there are many more relay
connections and (2) that they are far messier. The reason is that a
relay connection performs two equating processes, one chained after the
other. This means that random measurement and sampling errors are
amplified.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>connection_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"C"</span>,</span>
<span>    <span class="va">connection_type</span> <span class="op">==</span> <span class="st">"relay"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">recoding_tables</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">source</span>,<span class="va">target</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">connection_id</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>This variability of equating solutions derived from relay connections
might seem worrying. However, if you will recall, QuestionLink does not
use these equating solutions separately. Instead, it aggregates them
into one solution by choosing the median equivalent score. Now let us do
the same and we immediately see that the median aggregated
<code>direct</code> connections and the median aggregated
<code>relay</code> connections match almost perfectly. The aggregation
over many links has mitigated the problem of randomness in measurement
and sampling.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">harmonization_solution</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connections_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span>,</span>
<span>    <span class="va">target_question</span> <span class="op">==</span> <span class="st">"C"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">recoding_tables</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">connection_type</span>, <span class="va">source</span>, <span class="va">target</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">connection_type</span>, <span class="va">source</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">source</span>,<span class="va">target</span>, color <span class="op">=</span> <span class="va">connection_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">connection_type</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">5.5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="several-populations">Several Populations<a class="anchor" aria-label="anchor" href="#several-populations"></a>
</h2>
<p>Until now, we only dealt with data from a single population (e.g.,
the adult German population). However, we often have harmonization tasks
where we have data from different populations, such as different
countries. However, we cannot form an equating connection across
populations. Each connection QuestionLink uses is within one population
(and at the approximately same point in time). However, what
QuestionLink can do is to perform its tasks population by population.
This means we have to find suitable connections in every population
(e.g., country), but then we can harmonize each populations’ data with
recoding tables that are specific to that population.</p>
<p>To illustrate this feature, we are copying our simulated dataset
three times and pretend that these data were gathered from the
populations, <code>pop_1</code>, <code>pop_2</code>, and
<code>pop_3</code>:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pop_1"</span>, <span class="st">"pop_2"</span>, <span class="st">"pop_3"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">qlink_format_df</span>, <span class="va">qlink_format_df</span>, <span class="va">qlink_format_df</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>The harmonization process with QuestionLink now stays exactly the
same. We do not even have to specify that we are now accessing the
multi-population mode. It is enough that our input data now has a
<code>population</code> column. Note how the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> of
the <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> object now signifies the three populations
with the message “Populations found:”pop_1”, “pop_2”, and “pop_3”“.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_harmonization_prepared</span> <span class="op">&lt;-</span> <span class="va">multi_pop_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">multi_pop_harmonization_prepared</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary: QuestionLink Prepare</span> <span style="color: #00BBBB;">───────────────────────────────────────────────</span></span></span></code></pre>
<pre><code><span><span class="co">## Current stage of the QuestionLink workflow: <span style="font-weight: bold;">ql_prepare ✔</span> -&gt; ql_harmonize -&gt;</span></span>
<span><span class="co">## ql_transform</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Number of unique question combinations: <span style="color: #0000BB;">12</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Number of found connections:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Direct connections: <span style="color: #0000BB;">84</span></span></span></code></pre>
<pre><code><span><span class="co">## • Time relaxation connections: <span style="color: #0000BB;">216</span></span></span></code></pre>
<pre><code><span><span class="co">## • Relay connections: <span style="color: #0000BB;">4530</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Additional information:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## • Populations found: <span style="color: #0000BB;">"pop_1"</span>, <span style="color: #0000BB;">"pop_2"</span>, and <span style="color: #0000BB;">"pop_3"</span></span></span></code></pre>
<pre><code><span><span class="co">## • No weight variable was supplied.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over question combinations:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Source question   Target question    Direct   Time relaxation   Relay</span></span>
<span><span class="co">## ----------------  ----------------  -------  ----------------  ------</span></span>
<span><span class="co">## A                 C                      24                NA     420</span></span>
<span><span class="co">## C                 A                      24                NA     420</span></span>
<span><span class="co">## B                 C                      18                NA     420</span></span>
<span><span class="co">## C                 B                      18                NA     420</span></span>
<span><span class="co">## A                 B                      NA                NA     291</span></span>
<span><span class="co">## A                 D                      NA                21     507</span></span>
<span><span class="co">## B                 A                      NA                NA     291</span></span>
<span><span class="co">## B                 D                      NA                21     375</span></span>
<span><span class="co">## C                 D                      NA                66     252</span></span>
<span><span class="co">## D                 A                      NA                21     507</span></span>
<span><span class="co">## D                 B                      NA                21     375</span></span>
<span><span class="co">## D                 C                      NA                66     252</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Overview over response options found:</span> ──</span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Question   Response options                User supplied </span></span>
<span><span class="co">## ---------  ------------------------------  --------------</span></span>
<span><span class="co">## A|pop_1    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## A|pop_2    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## A|pop_3    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## B|pop_1    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## B|pop_2    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## B|pop_3    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## C|pop_1    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## C|pop_2    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## C|pop_3    1, 2, 3, 4, 5                   FALSE         </span></span>
<span><span class="co">## D|pop_1    1, 2, 3, 4, 5, 6, 7, 8, 9, 10   FALSE         </span></span>
<span><span class="co">## D|pop_2    1, 2, 3, 4, 5, 6, 7, 8, 9, 10   FALSE         </span></span>
<span><span class="co">## D|pop_3    1, 2, 3, 4, 5, 6, 7, 8, 9, 10   FALSE</span></span></code></pre>
<p>We can also look at the connections plot for each population, simply
by calling <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code>
object:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_harmonization_prepared</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>combine_population_plots <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span></code></pre>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span></code></pre>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-23-2.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span></code></pre>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-23-3.png" width="700"></p>
<p>We can then harmonize the entire, multi-population data frame by
calling <code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code> and <code><a href="../reference/ql_transform.html">ql_transform()</a></code>:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_harmonization_prepared</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_transform.html">ql_transform</a></span><span class="op">(</span></span>
<span>    target_question <span class="op">=</span> <span class="st">"A"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
population
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:left;">
question
</th>
<th style="text-align:right;">
response
</th>
<th style="text-align:right;">
weight
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.278887
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.662703
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.278887
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.662703
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.278887
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
1.702287
</td>
</tr>
</tbody>
</table>
<p>What happens under the hood is that QuestionLink performs all steps
for each population, one after the other. If we look at the summarized
recoding tables in the <code><a href="../reference/ql_harmonize.html">ql_harmonize()</a></code> object, we see that
we get a recoding table for each question combination, in both
directions, for each population. Note that with <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count()</a></code> we
condense the recoding tables down to one line per recoding table,
arriving at 48 recoding tables (and rows): 4 instruments * 4 instruments
* 3 populations = 48.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_harmonization_prepared</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"summarized_rec_tbl"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">source_question</span>, <span class="va">target_question</span>, <span class="va">population</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 48 × 4</span></span></span>
<span><span class="co">##    source_question target_question population     n</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> A               A               pop_1          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> A               A               pop_2          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> A               A               pop_3          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> A               B               pop_1          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> A               B               pop_2          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> A               B               pop_3          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> A               C               pop_1          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> A               C               pop_2          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> A               C               pop_3          5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> A               D               pop_1          5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 38 more rows</span></span></span></code></pre>
<p>Lastly, what happens if we cannot find links for some questions in
some populations? As an example, we delete question A from the
harmonization data in population 1. In such cases QuestionLink makes its
inability to harmonize some values transparent. Specifically, it details
which scores of which instrument in which population were not
harmonized.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_pop_research_data</span> <span class="op">&lt;-</span> <span class="va">multi_pop_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">population</span>,</span>
<span>            source_question <span class="op">=</span> <span class="va">question</span>,</span>
<span>            <span class="va">response</span><span class="op">)</span></span>
<span></span>
<span><span class="va">multi_pop_harmonization_data_incomplete</span> <span class="op">&lt;-</span> <span class="va">multi_pop_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">population</span> <span class="op">==</span> <span class="st">"pop_1"</span> <span class="op">&amp;</span> <span class="va">question</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">multi_pop_harmonization_data_incomplete</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span></span>
<span>    use_relay <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    time_relaxation <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_harmonize.html">ql_harmonize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_transform.html">ql_transform</a></span><span class="op">(</span></span>
<span>    target_question <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>    new_data <span class="op">=</span> <span class="va">multi_pop_research_data</span></span>
<span>  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">incomplete_solution</span></span></code></pre></div>
<p>If we look at some examples for question A, we see that QuestionLink
has harmonized responses to question A in population 2 and 3. In
population 1, however, it has added NA values to indicate that no
harmonization solution was possible.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">incomplete_solution</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">source_question</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">|</span> <span class="va">target_question</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">first</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu">format_table</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
population
</th>
<th style="text-align:left;">
source_question
</th>
<th style="text-align:right;">
response
</th>
<th style="text-align:left;">
target_question
</th>
<th style="text-align:right;">
median_equivalent
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
pop_1
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_2
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.278887
</td>
</tr>
<tr>
<td style="text-align:left;">
pop_3
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
2.278887
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="overcoming-gaps-in-harmonization-data">Overcoming gaps in harmonization data<a class="anchor" aria-label="anchor" href="#overcoming-gaps-in-harmonization-data"></a>
</h2>
<p>The structure of QuestionLink is optimal for making use of existing
random samples of one (or more) populations collected by survey programs
over longer time series. However, in some cases there are simply
questions which cannot be harmonized with others with that approach.
Here we want to address some possible ways of overcoming such
limitations.</p>
<div class="section level3">
<h3 id="choosing-the-right-target-question">Choosing the right target question<a class="anchor" aria-label="anchor" href="#choosing-the-right-target-question"></a>
</h3>
<p>Often, the choice of target question (i.e., to which question’s
format to harmonize) is up to convenience. However, there are edge cases
where the choice of target question determines how many other questions
we can harmonize towards it.</p>
<p>Consider the following case:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chain_limit_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">5</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">12</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">19</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">26</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span>, time_relaxation <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">chain_limit_prep</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>We immediately see that we can only directly harmonize temporally
adjacent questions:</p>
<ul>
<li><p>A to B</p></li>
<li><p>B to A and C</p></li>
<li><p>C to B and D</p></li>
<li><p>D to C</p></li>
</ul>
<p>However, we can use relays. Yet since relay (i.e., chained) equatings
incur amplifying random errors, QuestionLink limits relays to only one
jump. This means we cannot reach D from A or vice versa.</p>
<p>However, both B and C can reach all other questions:</p>
<ul>
<li><p>B has direct connections to A and C and a relay to D (via
C)</p></li>
<li><p>C has direct connections to B and D and a relay to A (via
B)</p></li>
</ul>
<p>Looking into the <code>connection</code> attribute of the
<code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> object, we can easily verify this with a bit
of data wrangling:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">number_of_questions</span> <span class="op">&lt;-</span> <span class="va">chain_limit_prep</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">question_connections_table</span> <span class="op">&lt;-</span> <span class="va">chain_limit_prep</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"connection"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">source_question</span>, <span class="va">target_question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">source_question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">source_question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    pct_link <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="op">(</span><span class="va">number_of_questions</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    question_connections <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">pct_link</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"no links"</span>,</span>
<span>      <span class="va">pct_link</span> <span class="op">==</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"links to all"</span>,</span>
<span>      <span class="va">pct_link</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">pct_link</span> <span class="op">&lt;</span> <span class="fl">100</span> <span class="op">~</span> <span class="st">"links to some"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    question_connections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">question_connections</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no links"</span>, <span class="st">"links to some"</span>, <span class="st">"links to all"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>question <span class="op">=</span> <span class="va">source_question</span>, <span class="va">question_connections</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">chain_limit_prep</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">question_connections_table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 44 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   year [32]</span></span></span>
<span><span class="co">##     year question question_connections</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>985 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>986 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>987 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>988 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">1</span>989 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">1</span>990 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">1</span>991 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">1</span>992 C        links to all        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">1</span>992 D        links to some       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">1</span>993 C        links to all        </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="cutting-intersecting-samples-down-to-size">Cutting intersecting samples down to size<a class="anchor" aria-label="anchor" href="#cutting-intersecting-samples-down-to-size"></a>
</h3>
<p>Sometimes the issue is that we do have random samples for two
questions, but the target population is not a perfect match. However, as
long as there is some overlap (i.e., intersection) between the target
populations of the data sources, we might still make do.</p>
<p>Examples for such situations include:</p>
<ul>
<li><p>Surveys which cover only a sub-population of the general
population of a country, such as samples of the employed population,
samples of migrants, or samples of women.</p></li>
<li><p>Surveys might also cover different age ranges.</p></li>
<li><p>Surveys might cover different regions, such as covering some but
not all federal states.</p></li>
</ul>
<p>In all these cases, we might still harmonize two questions of their
respective samples have an intersection of sufficient size. All we have
to do is to exclude cases from one or both samples so that their
remaining populations match.</p>
<p>For example, if we want to harmonize a sample of people in retirement
with a sample of the general population, we might exclude all
non-pensioners from the general sample and then match both of them for
harmonization. Or imagine a sample of adult women and a sample of only
employed people. We might exclude all unemployed respondents from the
first and all non-female people from the second sample to match
them.</p>
<p>However, please note that this might lead to small remaining sample
sizes, which increases the random error of each equating solution. This
is, of course, less of an issue if there are many such connections
(e.g., when there are many waves to harmonize).</p>
</div>
<div class="section level3">
<h3 id="conducting-split-half-experiments">Conducting split-half experiments<a class="anchor" aria-label="anchor" href="#conducting-split-half-experiments"></a>
</h3>
<p>Sometimes, there are simply no existing data to form a connection
between two questions. In such cases, we might consider collecting data
ourselves to bridge the missing connection(s). Of course it is seldom
feasible to collect random samples like the larger survey programs do.
However, if you will recall, the random groups design is traditionally a
split-half experiment. And our requirement for random samples was just
to be able to harmonize across survey programs. In a split-half
experiment, we get the “same population” requirement for free. This
means we can resort to cheaper sampling methods, such as non-probability
samples.</p>
<p>There are some aspects that we should consider, however:</p>
<ul>
<li><p>Sample size is key! Unlike other connections, we only get one
connection between two questions here. After all, we do this only when
there are no other connections. This means that the higher our sample
size, the better we can mitigate the random error of equating. (As a
rule of thumb: <em>N</em> &gt;= 2000.)</p></li>
<li><p>This not only affects the quality of harmonizing the two
questions in the experiment. Depending on the other questions and the
data availability, QuestionLink might route relay connections through
our split-half experiment data, using it as a relay. This means its
randomness is then injected into other harmonizations as well.</p></li>
<li><p>We should strive to at least ensure socio-demographic variety via
quotas. This does not make our data “representative” of the general
population, of course. However, the harmonization solution will be more
comparable, if we avoid a very homogenous sample; for example with
mostly highly educated respondents.</p></li>
<li><p>Lastly, note that we assume that both questions work the same way
in our non-probability sample as they do in the general population,
which we discuss more in the section <a href="#population-invariance">Population invariance</a>. Just for
clarification: We do not mean that we get the same response distribution
as in the general population. We mean that respondents should understand
the question in the same way (in the formal sense of measurement
invariance).</p></li>
</ul>
<div class="section level4">
<h4 id="adding-split-half-experiments-to-questionlink">Adding split-half experiments to QuestionLink<a class="anchor" aria-label="anchor" href="#adding-split-half-experiments-to-questionlink"></a>
</h4>
<p>Adding split-half experimental data to QuestionLink to bridge missing
connections is easily done, but the process might seem counter-intuitive
at first. It might be best to look at the practical process and then to
try and understand why it works the way it does.</p>
<p>Adding split-half experimental data works like this:</p>
<ol style="list-style-type: decimal">
<li>Bring the experimental data into a long format, just like we
normally do with data for QuestionLink. At this stage, we have a
<code>question</code> and a <code>response</code> column, with the
respective Question (i.e., condition in the split-half experiment) and
the individual response scores.</li>
<li>Next, we fill the <code>year</code> column. <strong>This step is
crucial!</strong> We have to choose years that are outside the range of
the years from the random sample surveys. Otherwise, QuestionLink might
equate one of our non-probability experimental conditions with a random
sample of one of the surveys. You can choose any arbitrary year that is
far enough away from the others so that it does not trigger the
time-relaxation range. However, it might perhaps be best to clearly
demarcate experimental data. You might choose years from previous or
future centuries or even negative years.</li>
<li>If you have different populations (e.g., countries), then we
recommend using experimental data only for the population it was
collected in. Thus enter that population’s id into the
<code>population</code> column.</li>
<li>If the random sample data sources use weights, add a
<code>weight</code> column to your experimental data, where every row
has the value <code>1</code>.</li>
<li>Lastly, add the experimental data as additional rows to your other
harmonization data (e.g., with <code><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row()</a></code> or a join). Then
proceed as normal with the QuestionLink R-package.</li>
</ol>
<p>The reason for this peculiar structure with imaginary data collection
years is that we want to fold experimental data into the QuestionLink
connection routing. However, we also need to avoid that QuestionLink
forms connections between the general population and our experimental
sample(s).</p>
<p>A last issue is that this process might lead to less readable and
perhaps confusing connection plots if we apply <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to
the <code><a href="../reference/ql_prepare.html">ql_prepare()</a></code> object.</p>
<p>However, this can be resolved with a bit of <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>
magic.</p>
<p>If you simply want to omit all experimental datapoints from the plot,
then you can use the <code>limits</code> argument in
<code>ggplot::scale_x_continuous()</code>. This way you can define the
minimum and maximum number of years to display. If you choose only the
range of the random sample surveys, the experiments are not
displayed.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Experimental years dummy data:</span></span>
<span><span class="va">experimental_years_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span>, time_relaxation <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<p>If we add negative year numbers to our data, the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
becomes unreadable:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Without limits</span></span>
<span></span>
<span><span class="va">experimental_years_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>However, if we exclude the experimental years, then it works as
normal:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># With limits</span></span>
<span><span class="va">experimental_years_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>If you want to clearly designate specific “years” as experiments, you
can proceed as follows. Here we set two imaginary experiments to 1960
and 1970, a bit away from the earliest random sample data from 1980.
Then we define labels for our experiments and supply those labels inside
<code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous()</a></code> as a custom <code>~</code> lambda
function with <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code>.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Experimental years dummy data:</span></span>
<span><span class="va">experimental_years_data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1960</span>, <span class="fl">1970</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1960</span>, <span class="fl">1970</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span> <span class="op">+</span><span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/ql_prepare.html">ql_prepare</a></span><span class="op">(</span>use_relay <span class="op">=</span> <span class="cn">TRUE</span>, time_relaxation <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># define experiment "years"</span></span>
<span><span class="va">experiment_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"1960"</span> <span class="op">=</span> <span class="st">"Experiment 1"</span>,</span>
<span>  <span class="st">"1970"</span> <span class="op">=</span> <span class="st">"Experiment 2"</span> </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">experimental_years_data_2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">experiment_labels</span><span class="op">)</span>, </span>
<span>                     <span class="va">experiment_labels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                     <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="advanced_use_cases_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="population-invariance">Population invariance<a class="anchor" aria-label="anchor" href="#population-invariance"></a>
</h2>
<p>One last issue is less technical, but rather a methodological
limitation of observed score equating. The issue of <strong>population
invariance</strong> becomes relevant when we want to apply the recoding
tables derived from harmonization data to other data which was measured
with the same questions. In simple terms, population invariance holds if
an equating solution derived from random groups data in one population
is the same as the equating solution we would get from random groups
data in another population.</p>
<p>If this were the case, then we can equate in one population and can
apply the recoding tables directly in the other population. However,
such population invariance is not guaranteed when applying observed
score equating algorithms. In formal terms, we only get population
invariance across two populations if both questions are
<strong>measurement invariant</strong> across the two populations. In
intuitive terms, this means we only get population invariance if the
questions are understood and respondent to in the same way in two
populations.</p>
<p>The problem is, of course, that we do not know if single-item
questions are measurement invariant. This is because all conventional
methods to assessing measurement invariance require multiple indicators
such as several items for one construct. As a concrete example, think of
multi group confirmatory factor analyses, which require several items
per factor.</p>
<p>Now in pragmatic terms, we can relegate this issue to assumptions.
Every harmonization project must make some assumptions about spearate
and joint data quality and this might just add another such assumption.
In fact, we routinely make this assumption when analyzing single-source
data in the social sciences. If we asked men and women in Germany how
interested they were in politics, and found a higher average score for
men, most researchers would say men are more interested in politics.
This means social scientists routinely assume measurement invariance;
here between male and female respondents.</p>
<p>The way QuestionLink is set up, it assumes population invariance
within each population defined with a unique <code>population</code> id.
It also assumes that population invariance between such groups is
violated and (chained) equating across populations is not desirable.
This way, users can make their own decisions. Up until now, we used
countries as population examples. However, you can also distinguish
subpopulations. In data from one country, you might define “women” and
“men” as ids in <code>population</code>. Then you would get separate
recoding tables which would also be used separately to other data.</p>
<p>Apart from which data to use for deriving the recoding tables, the
issue of population invariance also governs which other data we can
apply the recoding tables to. Imagine deriving recoding tables from
surveys of the general adult population in a country. Can you then use
the resulting recoding table to harmonize survey data collected in a
sample of teenagers? Well, you can if you feel confident that those
teenagers understand and treat the question similarly to adults.</p>
<p>Sometimes, we can also try to vet our population invariance
assumption <strong>empirically</strong>. Specifically, we can check for
population invariance when we have random groups data from both
populations. Then we can define these populations with a
<code>population</code> id and apply QuestionLink. If we get very
similar recoding tables in both (or more) populations, then this
supports the population invariance assumption.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthias Roth, Ranjit Konrad Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
